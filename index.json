[{"categories":["docker"],"content":"dockeråˆ›å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼ ","date":"2020-06-20","objectID":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/:0:0","tags":["docker"],"title":"dockeråˆ›å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼","uri":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/"},{"categories":["docker"],"content":"dockerfileæ–¹å¼ ","date":"2020-06-20","objectID":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/:1:0","tags":["docker"],"title":"dockeråˆ›å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼","uri":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/"},{"categories":["docker"],"content":"åˆ›å»ºdockerfile FROM php:7.4-cli ENV DEBIAN_FRONTEND noninteractive ENV TERM xterm-color ARG DEV_MODE ENV DEV_MODE $DEV_MODE COPY ./rootfilesystem/ / RUN \\ curl \\ -sfL \\ --connect-timeout 5 \\ --max-time 15 \\ --retry 5 \\ --retry-delay 2 \\ --retry-max-time 60 \\ http://getcomposer.org/installer | php -- --install-dir=\"/usr/bin\" --filename=composer \u0026\u0026 \\ chmod +x \"/usr/bin/composer\" \u0026\u0026 \\ composer self-update 1.10.6 \u0026\u0026 \\ apt-get update \u0026\u0026 \\ apt-get install -y \\ inotify-tools \\ libssl-dev \\ supervisor \\ unzip \\ zlib1g-dev \\ --no-install-recommends \u0026\u0026 \\ install-swoole.sh master \u0026\u0026 \\ mkdir -p /var/log/supervisor \u0026\u0026 \\ rm -rf /var/lib/apt/lists/* /usr/bin/qemu-*-static ENTRYPOINT [\"/entrypoint.sh\"] CMD [] WORKDIR \"/var/www/\" ","date":"2020-06-20","objectID":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/:1:1","tags":["docker"],"title":"dockeråˆ›å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼","uri":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/"},{"categories":["docker"],"content":"æ ¹æ®dockerfileç”Ÿæˆé•œåƒ æ‰§è¡Œå‘½ä»¤ docker build -t myswool . å…·ä½“çš„å‚æ•°å¯ä»¥å‚è€ƒ ","date":"2020-06-20","objectID":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/:1:2","tags":["docker"],"title":"dockeråˆ›å»ºé•œåƒæœ‰ä¸¤ç§æ–¹å¼","uri":"/docker%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/"},{"categories":["php"],"content":" \u003c?php $pid = pcntl_fork(); //çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šæ‰§è¡Œä¸‹é¢ä»£ç  if ($pid == -1) { //é”™è¯¯å¤„ç†ï¼šåˆ›å»ºå­è¿›ç¨‹å¤±è´¥æ—¶è¿”å›-1. die('could not fork'); } else if ($pid) { //çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ pcntl_wait($status); //ç­‰å¾…å­è¿›ç¨‹ä¸­æ–­ï¼Œé˜²æ­¢å­è¿›ç¨‹æˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚ } else { //å­è¿›ç¨‹å¾—åˆ°çš„$pidä¸º0, æ‰€ä»¥è¿™é‡Œæ˜¯å­è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ã€‚ } å¦‚æœä¸€ä¸ªä»»åŠ¡è¢«åˆ†è§£æˆå¤šä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå°±ä¼šå‡å°‘æ•´ä½“çš„è€—æ—¶ã€‚ æ¯”å¦‚æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ•°æ®æ–‡ä»¶è¦å¤„ç†ï¼Œè¿™ä¸ªæ–‡ä»¶ç”±å¾ˆå¤šè¡Œç»„æˆã€‚å¦‚æœå•è¿›ç¨‹æ‰§è¡Œè¦å¤„ç†çš„ä»»åŠ¡ï¼Œé‡å¾ˆå¤§æ—¶è¦è€—æ—¶æ¯”è¾ƒä¹…ã€‚è¿™æ—¶å¯ä»¥è€ƒè™‘å¤šè¿›ç¨‹ã€‚ æœ‰ä¸€ä¸ª1000ä¸‡ä¸ªå…ƒç´ çš„intæ•°ç»„ï¼Œéœ€è¦æ±‚å’Œï¼Œå¹³å‡åˆ†åˆ°4ä¸ªè¿›ç¨‹å¤„ç†ï¼Œæ¯ä¸ªè¿›ç¨‹å¤„ç†ä¸€éƒ¨åˆ†ï¼Œå†å°†ç»“æœç»Ÿè®¡å‡ºæ¥ï¼Œä»£ç å¦‚ä¸‹ \u003c?php $arrint = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];//å‡è®¾å¾ˆå¤š $arrint = array_chunk($arrint,4,TRUE); for ($i = 0; $i \u003c 4; $i++){ $pid = pcntl_fork(); if ($pid == -1) { die(\"could not fork\"); } elseif ($pid) { echo $pid; echo \"I'm the Parent $i\\n\"; } else { // å­è¿›ç¨‹å¤„ç† // $content = file_get_contents(\"prefix_name0\".$i); $psum = array_sum($arrint[$i]); echo $psum . \"\\n\";åˆ†åˆ«è¾“å‡ºå­è¿›ç¨‹çš„éƒ¨åˆ†æ±‚å’Œæ•°å­—ï¼Œä½†æ˜¯æ— æ³•è¿›è¡Œæƒ³åŠ ï¼Œå› ä¸ºè¿›ç¨‹äº’ç›¸ç‹¬ç«‹ exit;// ä¸€å®šè¦æ³¨æ„é€€å‡ºå­è¿›ç¨‹,å¦åˆ™pcntl_fork() ä¼šè¢«å­è¿›ç¨‹å†fork,å¸¦æ¥å¤„ç†ä¸Šçš„å½±å“ã€‚ } } // ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œç»“ while (pcntl_waitpid(0, $status) != -1) { $status = pcntl_wexitstatus($status); echo \"Child $statuscompleted\\n\"; } ä¸Šè¯‰ç­”æ¡ˆä¸­ï¼Œæ˜¯æŠŠæ•°ç»„åˆ†ä¸º4ä¸ªå­æ•°ç»„åˆ†åˆ«ç”¨4ä¸ªå­è¿›ç¨‹å»å¤„ç†äº†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•æŠŠæ‰€è®¡ç®—çš„ç»“æœç›¸åŠ ï¼Œå› ä¸ºè¿›ç¨‹éƒ½æ˜¯ç‹¬ç«‹å®Œæˆä»»åŠ¡çš„ï¼Œæ²¡æœ‰åŠæ³•å…±äº«åŒä¸€ä¸ªï¼ˆå†…å­˜ï¼‰å˜é‡ï¼Œä¸‹é¢å°†å¼•è¿›æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³è¿›ç¨‹é€šä¿¡çš„é—®é¢˜ \u003c?php $arrint = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];//å‡è®¾å¾ˆå¤š $arrint = array_chunk($arrint,4,TRUE);//æŠŠæ•°ç»„åˆ†ä¸º4ä¸ª // åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—,ä»¥åŠå®šä¹‰æ¶ˆæ¯ç±»å‹(ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„åº“) $id = ftok(__FILE__,'m');//ç”Ÿæˆæ–‡ä»¶keyï¼Œå”¯ä¸€ $msgQueue = msg_get_queue($id); const MSG_TYPE = 1; msg_send($msgQueue,MSG_TYPE,'0');//ç»™æ¶ˆæ¯é˜Ÿåˆ—ä¸€ä¸ªé»˜è®¤å€¼0ï¼Œå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹ //forkå‡ºå››ä¸ªå­è¿›ç¨‹ for ($i = 0; $i \u003c 4; $i++){ $pid = pcntl_fork(); if ($pid == -1) { die(\"could not fork\"); } elseif ($pid) { echo $pid; echo \"I'm the Parent $i\\n\"; } else { // å­è¿›ç¨‹å¤„ç†é€»è¾‘ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œè§£å†³åŠæ³•ï¼Œæ”¾åˆ°å†…å­˜æ¶ˆæ¯é˜Ÿåˆ—ä¸­ $part = array_sum($arrint[$i]); implode_sum($part);//åˆæˆè®¡ç®—å‡ºçš„sum exit;// ä¸€å®šè¦æ³¨æ„é€€å‡ºå­è¿›ç¨‹,å¦åˆ™pcntl_fork() ä¼šè¢«å­è¿›ç¨‹å†fork,å¸¦æ¥å¤„ç†ä¸Šçš„å½±å“ã€‚ } } function implode_sum($part){ global $msgQueue; msg_receive($msgQueue,MSG_TYPE,$msgType,1024,$sum);//è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å€¼ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¸ºé˜Ÿåˆ—ä¸­çš„å€¼ $sum = intval($sum) + $part; msg_send($msgQueue,MSG_TYPE,$sum);//å‘é€æ¯æ¬¡è®¡ç®—çš„ç»“æœç»™æ¶ˆæ¯é˜Ÿåˆ— } // ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œç»“æŸ while (pcntl_waitpid(0, $status) != -1) { $status = pcntl_wexitstatus($status); $pid = posix_getpid(); echo \"Child $statuscompleted\\n\"; } //æ‰€æœ‰å­è¿›ç¨‹ç»“æŸåï¼Œå†å–å‡ºæœ€ååœ¨é˜Ÿåˆ—ä¸­çš„å€¼ï¼Œå°±æ˜¯intæ•°ç»„çš„å’Œ msg_receive($msgQueue,MSG_TYPE,$msgType,1024,$sum); echo $sum;//è¾“å‡º120 ","date":"2020-06-17","objectID":"/php%E5%A4%9A%E8%BF%9B%E7%A8%8B/:0:0","tags":["phpå¤šè¿›ç¨‹"],"title":"phpå¤šè¿›ç¨‹","uri":"/php%E5%A4%9A%E8%BF%9B%E7%A8%8B/"},{"categories":["swoole"],"content":"è¿›ç¨‹ç»“æ„å›¾ ","date":"2020-05-27","objectID":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/:0:1","tags":null,"title":"swooleè¿›ç¨‹æ¨¡å‹","uri":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/"},{"categories":["swoole"],"content":"Reactor çº¿ç¨‹ Reactor çº¿ç¨‹æ˜¯åœ¨ Master è¿›ç¨‹ä¸­åˆ›å»ºçš„çº¿ç¨‹ è´Ÿè´£ç»´æŠ¤å®¢æˆ·ç«¯ TCP è¿æ¥ã€å¤„ç†ç½‘ç»œ IOã€å¤„ç†åè®®ã€æ”¶å‘æ•°æ® ä¸æ‰§è¡Œä»»ä½• PHP ä»£ç  å°† TCP å®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ç¼“å†²ã€æ‹¼æ¥ã€æ‹†åˆ†æˆå®Œæ•´çš„ä¸€ä¸ªè¯·æ±‚æ•°æ®åŒ… ","date":"2020-05-27","objectID":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/:0:2","tags":null,"title":"swooleè¿›ç¨‹æ¨¡å‹","uri":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/"},{"categories":["swoole"],"content":"Worker è¿›ç¨‹ æ¥å—ç”± Reactor çº¿ç¨‹æŠ•é€’çš„è¯·æ±‚æ•°æ®åŒ…ï¼Œå¹¶æ‰§è¡Œ PHP å›è°ƒå‡½æ•°å¤„ç†æ•°æ® ç”Ÿæˆå“åº”æ•°æ®å¹¶å‘ç»™ Reactor çº¿ç¨‹ï¼Œç”± Reactor çº¿ç¨‹å‘é€ç»™ TCP å®¢æˆ·ç«¯ å¯ä»¥æ˜¯å¼‚æ­¥éé˜»å¡æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒæ­¥é˜»å¡æ¨¡å¼ Worker ä»¥å¤šè¿›ç¨‹çš„æ–¹å¼è¿è¡Œ ","date":"2020-05-27","objectID":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/:0:3","tags":null,"title":"swooleè¿›ç¨‹æ¨¡å‹","uri":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/"},{"categories":["swoole"],"content":"TaskWorker è¿›ç¨‹ æ¥å—ç”± Worker è¿›ç¨‹é€šè¿‡ Swoole\\Server-\u003etask/taskwait/taskCo/taskWaitMulti æ–¹æ³•æŠ•é€’çš„ä»»åŠ¡ å¤„ç†ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœæ•°æ®è¿”å›ï¼ˆä½¿ç”¨ Swoole\\Server-\u003efinishç»™ Worker è¿›ç¨‹ å®Œå…¨æ˜¯åŒæ­¥é˜»å¡æ¨¡å¼ TaskWorker ä»¥å¤šè¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œtask å®Œæ•´ç¤ºä¾‹ ","date":"2020-05-27","objectID":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/:0:4","tags":null,"title":"swooleè¿›ç¨‹æ¨¡å‹","uri":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/"},{"categories":["swoole"],"content":"Manager è¿›ç¨‹ è´Ÿè´£åˆ›å»º / å›æ”¶ worker/task è¿›ç¨‹ ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¯ä»¥ç†è§£ä¸º Reactor å°±æ˜¯ nginxï¼ŒWorker å°±æ˜¯ PHP-FPMã€‚Reactor çº¿ç¨‹å¼‚æ­¥å¹¶è¡Œåœ°å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œç„¶åå†è½¬å‘ç»™ Worker è¿›ç¨‹ä¸­å»å¤„ç†ã€‚Reactor å’Œ Worker é—´é€šè¿‡ unixSocket è¿›è¡Œé€šä¿¡ã€‚ åœ¨ PHP-FPM çš„åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šå°†ä¸€ä¸ªä»»åŠ¡å¼‚æ­¥æŠ•é€’åˆ° Redis ç­‰é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨åå°å¯åŠ¨ä¸€äº› PHP è¿›ç¨‹å¼‚æ­¥åœ°å¤„ç†è¿™äº›ä»»åŠ¡ã€‚Swoole æä¾›çš„ TaskWorker æ˜¯ä¸€å¥—æ›´å®Œæ•´çš„æ–¹æ¡ˆï¼Œå°†ä»»åŠ¡çš„æŠ•é€’ã€é˜Ÿåˆ—ã€PHP ä»»åŠ¡å¤„ç†è¿›ç¨‹ç®¡ç†åˆä¸ºä¸€ä½“ã€‚é€šè¿‡åº•å±‚æä¾›çš„ API å¯ä»¥éå¸¸ç®€å•åœ°å®ç°å¼‚æ­¥ä»»åŠ¡çš„å¤„ç†ã€‚å¦å¤– TaskWorker è¿˜å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œå†è¿”å›ä¸€ä¸ªç»“æœåé¦ˆåˆ° Workerã€‚ Swoole çš„ Reactorã€Workerã€TaskWorker ä¹‹é—´å¯ä»¥ç´§å¯†çš„ç»“åˆèµ·æ¥ï¼Œæä¾›æ›´é«˜çº§çš„ä½¿ç”¨æ–¹å¼ã€‚ ä¸€ä¸ªæ›´é€šä¿—çš„æ¯”å–»ï¼Œå‡è®¾ Server å°±æ˜¯ä¸€ä¸ªå·¥å‚ï¼Œé‚£ Reactor å°±æ˜¯é”€å”®ï¼Œæ¥å—å®¢æˆ·è®¢å•ã€‚è€Œ Worker å°±æ˜¯å·¥äººï¼Œå½“é”€å”®æ¥åˆ°è®¢å•åï¼ŒWorker å»å·¥ä½œç”Ÿäº§å‡ºå®¢æˆ·è¦çš„ä¸œè¥¿ã€‚è€Œ TaskWorker å¯ä»¥ç†è§£ä¸ºè¡Œæ”¿äººå‘˜ï¼Œå¯ä»¥å¸®åŠ© Worker å¹²äº›æ‚äº‹ï¼Œè®© Worker ä¸“å¿ƒå·¥ä½œã€‚ å¦‚å›¾ï¼š ","date":"2020-05-27","objectID":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/:0:5","tags":null,"title":"swooleè¿›ç¨‹æ¨¡å‹","uri":"/swoole%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/"},{"categories":["å‹æµ‹"],"content":"1ã€å®‰è£…influxdb docker search influx docker pull influxdb docker run --name my_influ -p 8086:8086 influxdb docker exec -it my_influ /bin/bash åˆ›å»ºæ•°æ®åº“ influx create database jmeter show databases exit ","date":"2020-05-25","objectID":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/:0:1","tags":null,"title":"jmeter+grafana+influxdbå¯è§†åŒ–æ€§èƒ½ç›‘æ§å¹³å°","uri":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/"},{"categories":["å‹æµ‹"],"content":"2ã€å®‰è£…grafana docker search grafana docker pull grafana/grafana docker run --name my_grafana -p 3000:3000 grafana/grafana è¿›å…¥å®¹å™¨ä¹Ÿå¯ä»¥é€šè¿‡dockerçš„k8sè¿›å…¥ ","date":"2020-05-25","objectID":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/:0:2","tags":null,"title":"jmeter+grafana+influxdbå¯è§†åŒ–æ€§èƒ½ç›‘æ§å¹³å°","uri":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/"},{"categories":["å‹æµ‹"],"content":"3ã€é…ç½® é¿å‘æç¤º è®¿é—®ä½¿ç”¨å†…ç½‘ç§æœ‰åœ°å€å¦‚æœ¬æœºçš„192.168.31.209ï¼Œä¸è¦ä½¿ç”¨127.0.0.1ï¼Œä¸ç„¶æœ‰å‘ è®¿é—®grafana http://192.168.31.209:3000/ï¼Œç™»å½•admin/admin æ·»åŠ æ•°æ®æº å³åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“ é…ç½®å¦‚ä¸‹ å±•ç¤ºæ¨¡æ¿ https://grafana.com/grafana/dashboards/5496 ä¸‹è½½å¯¹åº”çš„jsonæ–‡ä»¶ï¼Œå¯¼å…¥åˆ°grafana å¯¼å…¥æˆåŠŸåå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç•Œé¢ã€‚ ","date":"2020-05-25","objectID":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/:0:3","tags":null,"title":"jmeter+grafana+influxdbå¯è§†åŒ–æ€§èƒ½ç›‘æ§å¹³å°","uri":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/"},{"categories":["å‹æµ‹"],"content":"4ã€jemeteré…ç½® å®‰è£…ä¸å¯åŠ¨ ç•¥ çº¿ç¨‹ç»„é…ç½® åç«¯ç›‘å¬å™¨é…ç½® ","date":"2020-05-25","objectID":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/:0:4","tags":null,"title":"jmeter+grafana+influxdbå¯è§†åŒ–æ€§èƒ½ç›‘æ§å¹³å°","uri":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/"},{"categories":["å‹æµ‹"],"content":"5ã€å¼€å§‹å‹æµ‹ ç‚¹å‡»jemeterå¯åŠ¨æŒ‰é’®å¼€å§‹å‹æµ‹ ","date":"2020-05-25","objectID":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/:0:5","tags":null,"title":"jmeter+grafana+influxdbå¯è§†åŒ–æ€§èƒ½ç›‘æ§å¹³å°","uri":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/"},{"categories":["å‹æµ‹"],"content":"6ã€æµ‹è¯•ç»“æœ ","date":"2020-05-25","objectID":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/:0:6","tags":null,"title":"jmeter+grafana+influxdbå¯è§†åŒ–æ€§èƒ½ç›‘æ§å¹³å°","uri":"/docker%E4%B8%8B%E6%90%AD%E5%BB%BAjmeter-grafana-influxdb%E5%8F%AF%E8%A7%86%E5%8C%96%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/"},{"categories":["php"],"content":"PHP-FPM çš„è¿ä½œæ¨¡å¼ PHP-FPMæ˜¯ä¸€ä¸ªå¤šè¿›ç¨‹çš„ FastCGI ç®¡ç†ç¨‹åºï¼Œæ˜¯ç»å¤§å¤šæ•° PHPåº”ç”¨æ‰€ä½¿ç”¨çš„è¿è¡Œæ¨¡å¼ã€‚ å‡è®¾æˆ‘ä»¬ä½¿ç”¨ Nginx æä¾› HTTP æœåŠ¡ï¼ˆApache åŒç†ï¼‰ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚æœ€å…ˆæŠµè¾¾çš„éƒ½æ˜¯ Nginxï¼Œç„¶å Nginx é€šè¿‡ FastCGI åè®®å°†è¯·æ±‚è½¬å‘ç»™ PHP-FPM å¤„ç†ï¼ŒPHP-FPM çš„ Worker è¿›ç¨‹ ä¼šæŠ¢å å¼çš„è·å¾— CGI è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªå¤„ç†æŒ‡çš„å°±æ˜¯ï¼Œç­‰å¾… PHP è„šæœ¬çš„è§£æï¼Œç­‰å¾…ä¸šåŠ¡å¤„ç†çš„ç»“æœè¿”å›ï¼Œå®Œæˆåå›æ”¶å­è¿›ç¨‹ï¼Œè¿™æ•´ä¸ªçš„è¿‡ç¨‹æ˜¯é˜»å¡ç­‰å¾…çš„ï¼Œä¹Ÿå°±æ„å‘³ç€ PHP-FPM çš„è¿›ç¨‹æ•°æœ‰å¤šå°‘èƒ½å¤„ç†çš„è¯·æ±‚ä¹Ÿå°±æ˜¯å¤šå°‘ï¼Œå‡è®¾ PHP-FPM æœ‰ 200 ä¸ª Worker è¿›ç¨‹ï¼Œä¸€ä¸ªè¯·æ±‚å°†è€—è´¹ 1 ç§’çš„æ—¶é—´ï¼Œé‚£ä¹ˆç®€å•çš„æ¥è¯´æ•´ä¸ªæœåŠ¡å™¨ç†è®ºä¸Šæœ€å¤šå¯ä»¥å¤„ç†çš„è¯·æ±‚ä¹Ÿå°±æ˜¯ 200 ä¸ªï¼ŒQPS å³ä¸º 200/sï¼Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™æ ·çš„æ€§èƒ½å¾€å¾€æ˜¯ä¸å¤Ÿçš„ï¼Œå°½ç®¡å¯ä»¥åˆ©ç”¨ Nginx ä½œä¸ºè´Ÿè½½å‡è¡¡é…åˆå¤šå° PHP-FPM æœåŠ¡å™¨æ¥æä¾›æœåŠ¡ï¼Œä½†ç”±äº PHP-FPM çš„é˜»å¡ç­‰å¾…çš„å·¥ä½œæ¨¡å‹ï¼Œä¸€ä¸ªè¯·æ±‚ä¼šå ç”¨è‡³å°‘ä¸€ä¸ª MySQL è¿æ¥ï¼Œå¤šèŠ‚ç‚¹é«˜å¹¶å‘ä¸‹ä¼šäº§ç”Ÿå¤§é‡çš„ MySQL è¿æ¥ï¼Œè€Œ MySQL çš„æœ€å¤§è¿æ¥æ•°é»˜è®¤å€¼ä¸º 100ï¼Œå°½ç®¡å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¾è€Œæ˜“è§è¯¥æ¨¡å¼æ²¡æ³•å¾ˆå¥½çš„åº”å¯¹é«˜å¹¶å‘çš„åœºæ™¯ã€‚ PHP-FPM å³ PHP FastCGI è¿›ç¨‹ç®¡ç†å™¨ï¼Œè¦äº†è§£ PHP-FPM ï¼Œé¦–å…ˆè¦çœ‹çœ‹ CGI ä¸ FastCGI çš„å…³ç³»ã€‚ ","date":"2020-05-25","objectID":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/:0:1","tags":["phpå¤šè¿›ç¨‹"],"title":"php-fpmè¿ä½œåŸç†","uri":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/"},{"categories":["php"],"content":"CGI CGI çš„è‹±æ–‡å…¨åæ˜¯ Common Gateway Interfaceï¼Œå³é€šç”¨ç½‘å…³æ¥å£ï¼Œæ˜¯ Web æœåŠ¡å™¨è°ƒç”¨å¤–éƒ¨ç¨‹åºæ—¶æ‰€ä½¿ç”¨çš„ä¸€ç§æœåŠ¡ç«¯åº”ç”¨çš„è§„èŒƒã€‚ æ—©æœŸçš„ Web é€šä¿¡åªæ˜¯æŒ‰ç…§å®¢æˆ·ç«¯è¯·æ±‚å°†ä¿å­˜åœ¨ Web æœåŠ¡å™¨ç¡¬ç›˜ä¸­çš„æ•°æ®è½¬å‘è¿‡å»è€Œå·²ï¼Œè¿™ç§æƒ…å†µä¸‹å®¢æˆ·ç«¯æ¯æ¬¡è·å–çš„ä¿¡æ¯ä¹Ÿæ˜¯åŒæ ·çš„å†…å®¹ï¼ˆå³é™æ€è¯·æ±‚ï¼Œæ¯”å¦‚å›¾ç‰‡ã€æ ·å¼æ–‡ä»¶ã€HTMLæ–‡æ¡£ï¼‰ï¼Œè€Œéšç€ Web çš„å‘å±•ï¼ŒWeb æ‰€èƒ½å‘ˆç°çš„å†…å®¹æ›´åŠ ä¸°å¯Œï¼Œä¸ç”¨æˆ·çš„äº¤äº’æ—¥ç›Šé¢‘ç¹ï¼Œæ¯”å¦‚åšå®¢ã€è®ºå›ã€ç”µå•†ç½‘ç«™ã€ç¤¾äº¤ç½‘ç»œç­‰ã€‚ è¿™ä¸ªæ—¶å€™ä»…ä»…é€šè¿‡é™æ€èµ„æºå·²ç»æ— æ³•æ»¡è¶³ Web é€šä¿¡çš„éœ€æ±‚ï¼Œæ‰€ä»¥å¼•å…¥ CGI ä»¥ä¾¿å®¢æˆ·ç«¯è¯·æ±‚èƒ½å¤Ÿè§¦å‘ Web æœåŠ¡å™¨è¿è¡Œå¦ä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼Œå®¢æˆ·ç«¯æ‰€è¾“å…¥çš„æ•°æ®ä¹Ÿä¼šä¼ ç»™è¿™ä¸ªå¤–éƒ¨ç¨‹åºï¼Œè¯¥ç¨‹åºè¿è¡Œç»“æŸåä¼šå°†ç”Ÿæˆçš„ HTML å’Œå…¶ä»–æ•°æ®é€šè¿‡ Web æœåŠ¡å™¨å†è¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆå³åŠ¨æ€è¯·æ±‚ï¼Œæ¯”å¦‚åŸºäº PHPã€Pythonã€Java å®ç°çš„åº”ç”¨ï¼‰ã€‚åˆ©ç”¨ CGI å¯ä»¥é’ˆå¯¹ç”¨æˆ·è¯·æ±‚åŠ¨æ€è¿”å›ç»™å®¢æˆ·ç«¯å„ç§å„æ ·åŠ¨æ€å˜åŒ–çš„ä¿¡æ¯ã€‚ ","date":"2020-05-25","objectID":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/:0:2","tags":["phpå¤šè¿›ç¨‹"],"title":"php-fpmè¿ä½œåŸç†","uri":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/"},{"categories":["php"],"content":"FastCGI FastCGI é¡¾åæ€ä¹‰ï¼Œæ˜¯ CGI çš„å‡çº§ç‰ˆæœ¬ï¼Œä¸ºäº†æå‡ CGI çš„æ€§èƒ½è€Œç”Ÿï¼ŒCGI é’ˆå¯¹æ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼š fork ä¸€ä¸ªæ–°è¿›ç¨‹æ¥è¿›è¡Œå¤„ç†ï¼ˆè§£æé…ç½®æ–‡ä»¶ã€åˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒã€å¤„ç†è¯·æ±‚ï¼‰ï¼Œç„¶åæŠŠè¿™ä¸ªè¿›ç¨‹å¤„ç†å®Œçš„ç»“æœé€šè¿‡ Web æœåŠ¡å™¨è½¬å‘ç»™ç”¨æˆ·ï¼Œåˆšåˆš fork çš„æ–°è¿›ç¨‹ä¹Ÿéšä¹‹é€€å‡ºï¼Œå¦‚æœä¸‹æ¬¡ç”¨æˆ·å†è¯·æ±‚åŠ¨æ€èµ„æºï¼Œé‚£ä¹ˆ Web æœåŠ¡å™¨åˆå†æ¬¡ fork ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œå¦‚æ­¤å‘¨è€Œå¤å§‹å¾ªç¯å¾€å¤ã€‚ è€Œ FastCGI åˆ™ä¼šå…ˆ fork ä¸€ä¸ª master è¿›ç¨‹ï¼Œè§£æé…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå† fork å¤šä¸ª worker è¿›ç¨‹ï¼ˆä¸ Nginx æœ‰ç‚¹åƒï¼‰ï¼Œå½“ HTTP è¯·æ±‚è¿‡æ¥æ—¶ï¼Œmaster è¿›ç¨‹å°†å…¶ä¼šä¼ é€’ç»™ä¸€ä¸ª worker è¿›ç¨‹ï¼Œç„¶åç«‹å³å¯ä»¥æ¥å—ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™æ ·å°±é¿å…äº†é‡å¤çš„åˆå§‹åŒ–æ“ä½œï¼Œæ•ˆç‡è‡ªç„¶ä¹Ÿå°±æé«˜äº†ã€‚ è€Œä¸”å½“ worker è¿›ç¨‹ä¸å¤Ÿç”¨æ—¶ï¼Œmaster è¿›ç¨‹è¿˜å¯ä»¥æ ¹æ®é…ç½®é¢„å…ˆå¯åŠ¨å‡ ä¸ª worker è¿›ç¨‹ç­‰ç€ï¼› å½“ç©ºé—² worker è¿›ç¨‹å¤ªå¤šæ—¶ï¼Œä¹Ÿä¼šå…³æ‰ä¸€äº›ï¼Œè¿™æ ·ä¸ä»…æé«˜äº†æ€§èƒ½ï¼Œè¿˜èŠ‚çº¦äº†ç³»ç»Ÿèµ„æºã€‚ ","date":"2020-05-25","objectID":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/:0:3","tags":["phpå¤šè¿›ç¨‹"],"title":"php-fpmè¿ä½œåŸç†","uri":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/"},{"categories":["php"],"content":"PHP-FPM FastCGI åªæ˜¯ä¸€ä¸ªåè®®è§„èŒƒï¼Œéœ€è¦æ¯ä¸ªè¯­è¨€å…·ä½“å»å®ç°ï¼ŒPHP-FPM å°±æ˜¯ PHP ç‰ˆæœ¬çš„ FastCGI åè®®å®ç°ã€‚ masterè¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œè´Ÿè´£ç›‘å¬ç«¯å£ï¼Œæ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œè€Œworkerè¿›ç¨‹åˆ™ä¸€èˆ¬æœ‰å¤šä¸ªï¼ˆå…·ä½“æ•°é‡æ ¹æ®å®é™…éœ€è¦é…ç½®ï¼‰ï¼Œæ¯ä¸ªè¿›ç¨‹å†…éƒ¨éƒ½åµŒå…¥äº†ä¸€ä¸ªPHPè§£é‡Šå™¨ï¼Œ æ˜¯PHPä»£ç çœŸæ­£æ‰§è¡Œçš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š1ä¸ªmasterè¿›ç¨‹ï¼Œ2ä¸ªworkerè¿›ç¨‹ã€‚ ä»FPMæ¥æ”¶åˆ°è¯·æ±‚ï¼Œåˆ°å¤„ç†å®Œæ¯•ï¼Œå…¶å…·ä½“çš„æµç¨‹å¦‚ä¸‹ FPMçš„masterè¿›ç¨‹æ¥æ”¶åˆ°è¯·æ±‚ã€‚ masterè¿›ç¨‹æ ¹æ®é…ç½®æŒ‡æ´¾ç‰¹å®šçš„workerè¿›ç¨‹è¿›è¡Œè¯·æ±‚å¤„ç†ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨è¿›ç¨‹ï¼Œè¿”å›é”™è¯¯ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é…åˆNginxé‡åˆ°502é”™è¯¯æ¯”è¾ƒå¤šçš„åŸå› ã€‚ workerè¿›ç¨‹å¤„ç†è¯·æ±‚ï¼Œå¦‚æœè¶…æ—¶ï¼Œè¿”å›504é”™è¯¯ã€‚ è¯·æ±‚å¤„ç†ç»“æŸï¼Œè¿”å›ç»“æœã€‚ ","date":"2020-05-25","objectID":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/:0:4","tags":["phpå¤šè¿›ç¨‹"],"title":"php-fpmè¿ä½œåŸç†","uri":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/"},{"categories":["php"],"content":"PHP-FPMé…ç½®æ–‡ä»¶ pid = run/php-fpm.pid #pidè®¾ç½®ï¼Œé»˜è®¤åœ¨å®‰è£…ç›®å½•ä¸­çš„var/run/php-fpm.pidï¼Œå»ºè®®å¼€å¯ error_log = log/php-fpm.log #é”™è¯¯æ—¥å¿—ï¼Œé»˜è®¤åœ¨å®‰è£…ç›®å½•ä¸­çš„var/log/php-fpm.log log_level = notice #é”™è¯¯çº§åˆ«. å¯ç”¨çº§åˆ«ä¸º: alertï¼ˆå¿…é¡»ç«‹å³å¤„ç†ï¼‰, errorï¼ˆé”™è¯¯æƒ…å†µï¼‰, warningï¼ˆè­¦å‘Šæƒ…å†µï¼‰, noticeï¼ˆä¸€èˆ¬é‡è¦ä¿¡æ¯ï¼‰, debugï¼ˆè°ƒè¯•ä¿¡æ¯ï¼‰. é»˜è®¤: notice. emergency_restart_threshold = 60 emergency_restart_interval = 60s #è¡¨ç¤ºåœ¨emergency_restart_intervalæ‰€è®¾å€¼å†…å‡ºç°SIGSEGVæˆ–è€…SIGBUSé”™è¯¯çš„php-cgiè¿›ç¨‹æ•°å¦‚æœè¶…è¿‡ emergency_restart_thresholdä¸ªï¼Œphp-fpmå°±ä¼šä¼˜é›…é‡å¯ã€‚è¿™ä¸¤ä¸ªé€‰é¡¹ä¸€èˆ¬ä¿æŒé»˜è®¤å€¼ã€‚ process_control_timeout = 0 #è®¾ç½®å­è¿›ç¨‹æ¥å—ä¸»è¿›ç¨‹å¤ç”¨ä¿¡å·çš„è¶…æ—¶æ—¶é—´. å¯ç”¨å•ä½: s(ç§’), m(åˆ†), h(å°æ—¶), æˆ–è€… d(å¤©) é»˜è®¤å•ä½: s(ç§’). é»˜è®¤å€¼: 0. daemonize = yes #åå°æ‰§è¡Œfpm,é»˜è®¤å€¼ä¸ºyesï¼Œå¦‚æœä¸ºäº†è°ƒè¯•å¯ä»¥æ”¹ä¸ºnoã€‚åœ¨FPMä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„è®¾ç½®æ¥è¿è¡Œå¤šä¸ªè¿›ç¨‹æ± ã€‚ è¿™äº›è®¾ç½®å¯ä»¥é’ˆå¯¹æ¯ä¸ªè¿›ç¨‹æ± å•ç‹¬è®¾ç½®ã€‚ listen = 127.0.0.1:9000 #fpmç›‘å¬ç«¯å£ï¼Œå³nginxä¸­phpå¤„ç†çš„åœ°å€ï¼Œä¸€èˆ¬é»˜è®¤å€¼å³å¯ã€‚å¯ç”¨æ ¼å¼ä¸º: â€˜ip:portâ€™, â€˜portâ€™, â€˜/path/to/unix/socketâ€™. æ¯ä¸ªè¿›ç¨‹æ± éƒ½éœ€è¦è®¾ç½®. listen.backlog = -1 #backlogæ•°ï¼Œ-1è¡¨ç¤ºæ— é™åˆ¶ï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šï¼Œæ­¤è¡Œæ³¨é‡Šæ‰å°±è¡Œã€‚ listen.allowed_clients = 127.0.0.1 #å…è®¸è®¿é—®FastCGIè¿›ç¨‹çš„IPï¼Œè®¾ç½®anyä¸ºä¸é™åˆ¶IPï¼Œå¦‚æœè¦è®¾ç½®å…¶ä»–ä¸»æœºçš„nginxä¹Ÿèƒ½è®¿é—®è¿™å°FPMè¿›ç¨‹ï¼Œlistenå¤„è¦è®¾ç½®æˆæœ¬åœ°å¯è¢«è®¿é—®çš„IPã€‚é»˜è®¤å€¼æ˜¯anyã€‚æ¯ä¸ªåœ°å€æ˜¯ç”¨é€—å·åˆ†éš”. å¦‚æœæ²¡æœ‰è®¾ç½®æˆ–è€…ä¸ºç©ºï¼Œåˆ™å…è®¸ä»»ä½•æœåŠ¡å™¨è¯·æ±‚è¿æ¥ listen.owner = www listen.group = www listen.mode = 0666 #unix socketè®¾ç½®é€‰é¡¹ï¼Œå¦‚æœä½¿ç”¨tcpæ–¹å¼è®¿é—®ï¼Œè¿™é‡Œæ³¨é‡Šå³å¯ã€‚ user = www group = www #å¯åŠ¨è¿›ç¨‹çš„å¸æˆ·å’Œç»„ pm = dynamic #å¯¹äºä¸“ç”¨æœåŠ¡å™¨ï¼Œpmå¯ä»¥è®¾ç½®ä¸ºstaticã€‚ #å¦‚ä½•æ§åˆ¶å­è¿›ç¨‹ï¼Œé€‰é¡¹æœ‰staticå’Œdynamicã€‚å¦‚æœé€‰æ‹©staticï¼Œåˆ™ç”±pm.max_childrenæŒ‡å®šå›ºå®šçš„å­è¿›ç¨‹æ•°ã€‚å¦‚æœé€‰æ‹©dynamicï¼Œåˆ™ç”±ä¸‹å¼€å‚æ•°å†³å®šï¼š pm.max_children #ï¼Œå­è¿›ç¨‹æœ€å¤§æ•° pm.start_servers #ï¼Œå¯åŠ¨æ—¶çš„è¿›ç¨‹æ•° pm.min_spare_servers #ï¼Œä¿è¯ç©ºé—²è¿›ç¨‹æ•°æœ€å°å€¼ï¼Œå¦‚æœç©ºé—²è¿›ç¨‹å°äºæ­¤å€¼ï¼Œåˆ™åˆ›å»ºæ–°çš„å­è¿›ç¨‹ pm.max_spare_servers #ï¼Œä¿è¯ç©ºé—²è¿›ç¨‹æ•°æœ€å¤§å€¼ï¼Œå¦‚æœç©ºé—²è¿›ç¨‹å¤§äºæ­¤å€¼ï¼Œæ­¤è¿›è¡Œæ¸…ç† pm.max_requests = 1000 #è®¾ç½®æ¯ä¸ªå­è¿›ç¨‹é‡ç”Ÿä¹‹å‰æœåŠ¡çš„è¯·æ±‚æ•°. å¯¹äºå¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„ç¬¬ä¸‰æ–¹æ¨¡å—æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„. å¦‚æœè®¾ç½®ä¸º â€™0â€² åˆ™ä¸€ç›´æ¥å—è¯·æ±‚. ç­‰åŒäº PHP_FCGI_MAX_REQUESTS ç¯å¢ƒå˜é‡. é»˜è®¤å€¼: 0. pm.status_path = /status #FPMçŠ¶æ€é¡µé¢çš„ç½‘å€. å¦‚æœæ²¡æœ‰è®¾ç½®, åˆ™æ— æ³•è®¿é—®çŠ¶æ€é¡µé¢. é»˜è®¤å€¼: none. muninç›‘æ§ä¼šä½¿ç”¨åˆ° ping.path = /ping #FPMç›‘æ§é¡µé¢çš„pingç½‘å€. å¦‚æœæ²¡æœ‰è®¾ç½®, åˆ™æ— æ³•è®¿é—®pingé¡µé¢. è¯¥é¡µé¢ç”¨äºå¤–éƒ¨æ£€æµ‹FPMæ˜¯å¦å­˜æ´»å¹¶ä¸”å¯ä»¥å“åº”è¯·æ±‚. è¯·æ³¨æ„å¿…é¡»ä»¥æ–œçº¿å¼€å¤´ (/)ã€‚ ping.response = pong #ç”¨äºå®šä¹‰pingè¯·æ±‚çš„è¿”å›ç›¸åº”. è¿”å›ä¸º HTTP 200 çš„ text/plain æ ¼å¼æ–‡æœ¬. é»˜è®¤å€¼: pong. request_terminate_timeout = 0 #è®¾ç½®å•ä¸ªè¯·æ±‚çš„è¶…æ—¶ä¸­æ­¢æ—¶é—´. è¯¥é€‰é¡¹å¯èƒ½ä¼šå¯¹php.iniè®¾ç½®ä¸­çš„â€™max_execution_timeâ€™å› ä¸ºæŸäº›ç‰¹æ®ŠåŸå› æ²¡æœ‰ä¸­æ­¢è¿è¡Œçš„è„šæœ¬æœ‰ç”¨. è®¾ç½®ä¸º â€™0â€² è¡¨ç¤º â€˜Offâ€™.å½“ç»å¸¸å‡ºç°502é”™è¯¯æ—¶å¯ä»¥å°è¯•æ›´æ”¹æ­¤é€‰é¡¹ã€‚ request_slowlog_timeout = 10s #å½“ä¸€ä¸ªè¯·æ±‚è¯¥è®¾ç½®çš„è¶…æ—¶æ—¶é—´åï¼Œå°±ä¼šå°†å¯¹åº”çš„PHPè°ƒç”¨å †æ ˆä¿¡æ¯å®Œæ•´å†™å…¥åˆ°æ…¢æ—¥å¿—ä¸­. è®¾ç½®ä¸º â€™0â€² è¡¨ç¤º â€˜Offâ€™ slowlog = log/$pool.log.slow #æ…¢è¯·æ±‚çš„è®°å½•æ—¥å¿—,é…åˆrequest_slowlog_timeoutä½¿ç”¨ rlimit_files = 1024 #è®¾ç½®æ–‡ä»¶æ‰“å¼€æè¿°ç¬¦çš„rlimité™åˆ¶. é»˜è®¤å€¼: ç³»ç»Ÿå®šä¹‰å€¼é»˜è®¤å¯æ‰“å¼€å¥æŸ„æ˜¯1024ï¼Œå¯ä½¿ç”¨ ulimit -næŸ¥çœ‹ï¼Œulimit -n 2048ä¿®æ”¹ã€‚ rlimit_core = 0 #è®¾ç½®æ ¸å¿ƒrlimitæœ€å¤§é™åˆ¶å€¼. å¯ç”¨å€¼: â€˜unlimitedâ€™ ã€0æˆ–è€…æ­£æ•´æ•°. é»˜è®¤å€¼: ç³»ç»Ÿå®šä¹‰å€¼. chroot = #å¯åŠ¨æ—¶çš„Chrootç›®å½•. æ‰€å®šä¹‰çš„ç›®å½•éœ€è¦æ˜¯ç»å¯¹è·¯å¾„. å¦‚æœæ²¡æœ‰è®¾ç½®, åˆ™chrootä¸è¢«ä½¿ç”¨. chdir = #è®¾ç½®å¯åŠ¨ç›®å½•ï¼Œå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨Chdiråˆ°è¯¥ç›®å½•. æ‰€å®šä¹‰çš„ç›®å½•éœ€è¦æ˜¯ç»å¯¹è·¯å¾„. é»˜è®¤å€¼: å½“å‰ç›®å½•ï¼Œæˆ–è€…/ç›®å½•ï¼ˆchrootæ—¶ï¼‰ catch_workers_output = yes #é‡å®šå‘è¿è¡Œè¿‡ç¨‹ä¸­çš„stdoutå’Œstderråˆ°ä¸»è¦çš„é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¸­. å¦‚æœæ²¡æœ‰è®¾ç½®, stdout å’Œ stderr å°†ä¼šæ ¹æ®FastCGIçš„è§„åˆ™è¢«é‡å®šå‘åˆ° /dev/null . é»˜è®¤å€¼: ç©º. ","date":"2020-05-25","objectID":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/:0:5","tags":["phpå¤šè¿›ç¨‹"],"title":"php-fpmè¿ä½œåŸç†","uri":"/php-fpm%E8%BF%90%E4%BD%9C%E5%8E%9F%E7%90%86/"},{"categories":["php"],"content":"å˜é‡å®¹å™¨ æ¯ä¸ªphpå˜é‡å­˜åœ¨ä¸€ä¸ªå«â€zvalâ€çš„å˜é‡å®¹å™¨ä¸­ã€‚ ä¸€ä¸ªzvalå˜é‡å®¹å™¨ï¼Œé™¤äº†åŒ…å«å˜é‡çš„ç±»å‹å’Œå€¼ï¼Œè¿˜åŒ…æ‹¬ä¸¤ä¸ªå­—èŠ‚çš„é¢å¤–ä¿¡æ¯ã€‚ is_ref ç¬¬ä¸€ä¸ªæ˜¯â€is_refâ€ï¼Œæ˜¯ä¸ªboolå€¼ï¼Œç”¨æ¥æ ‡è¯†è¿™ä¸ªå˜é‡æ˜¯å¦æ˜¯å±äºå¼•ç”¨é›†åˆ(reference set)ã€‚ ç¬¬ä¸€ä¸ªæ˜¯â€is_refâ€ï¼Œæ˜¯ä¸ªboolå€¼ï¼Œç”¨æ¥æ ‡è¯†è¿™ä¸ªå˜é‡æ˜¯å¦æ˜¯å±äºå¼•ç”¨é›†åˆ(reference set)ã€‚ é€šè¿‡è¿™ä¸ªå­—èŠ‚ï¼Œphpå¼•æ“æ‰èƒ½æŠŠæ™®é€šå˜é‡å’Œå¼•ç”¨å˜é‡åŒºåˆ†å¼€æ¥ï¼Œç”±äºphpå…è®¸ç”¨æˆ·é€šè¿‡ä½¿ç”¨\u0026æ¥ä½¿ç”¨è‡ªå®šä¹‰å¼•ç”¨ï¼Œzvalå˜é‡å®¹å™¨ä¸­è¿˜æœ‰ä¸€ä¸ªå†…éƒ¨å¼•ç”¨è®¡æ•°æœºåˆ¶ï¼Œæ¥ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ refcount ç¬¬äºŒä¸ªé¢å¤–å­—èŠ‚æ˜¯â€refcountâ€ï¼Œç”¨ä»¥è¡¨ç¤ºæŒ‡å‘è¿™ä¸ªzvalå˜é‡å®¹å™¨çš„å˜é‡(ä¹Ÿç§°ç¬¦å·å³symbol)ä¸ªæ•°ã€‚æ‰€æœ‰çš„ç¬¦å·å­˜åœ¨ä¸€ä¸ªç¬¦å·è¡¨ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªç¬¦å·éƒ½æœ‰ä½œç”¨åŸŸ(scope)ï¼Œé‚£äº›ä¸»è„šæœ¬(æ¯”å¦‚ï¼šé€šè¿‡æµè§ˆå™¨è¯·æ±‚çš„çš„è„šæœ¬)å’Œæ¯ä¸ªå‡½æ•°æˆ–è€…æ–¹æ³•ä¹Ÿéƒ½æœ‰ä½œç”¨åŸŸã€‚ ","date":"2020-05-25","objectID":"/php%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/:0:1","tags":null,"title":"PHPå¼•ç”¨è®¡æ•°","uri":"/php%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/"},{"categories":["php"],"content":"æ ‡é‡ç±»å‹ å½“ä¸€ä¸ªå˜é‡è¢«èµ‹å¸¸é‡å€¼æ—¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªzvalå˜é‡å®¹å™¨ï¼Œå¦‚ä¸‹ä¾‹è¿™æ ·ï¼š \u003c?php $a = \"new string\"; åœ¨ä¸Šä¾‹ä¸­ï¼Œæ–°çš„å˜é‡aï¼Œæ˜¯åœ¨å½“å‰ä½œç”¨åŸŸä¸­ç”Ÿæˆçš„ã€‚å¹¶ä¸”ç”Ÿæˆäº†ç±»å‹ä¸º stringå’Œå€¼ä¸ºnew stringçš„å˜é‡å®¹å™¨ã€‚ åœ¨é¢å¤–çš„ä¸¤ä¸ªå­—èŠ‚ä¿¡æ¯ä¸­ï¼Œâ€is_refâ€è¢«é»˜è®¤è®¾ç½®ä¸º FALSE ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•è‡ªå®šä¹‰çš„å¼•ç”¨ç”Ÿæˆã€‚â€refcountâ€ è¢«è®¾å®šä¸º 1ï¼Œå› ä¸ºè¿™é‡Œåªæœ‰ä¸€ä¸ªå˜é‡ä½¿ç”¨è¿™ä¸ªå˜é‡å®¹å™¨. æ³¨æ„åˆ°å½“â€refcountâ€çš„å€¼æ˜¯1æ—¶ï¼Œâ€is_refâ€çš„å€¼æ€»æ˜¯ FALSE . å¦‚æœä½ å·²ç»å®‰è£…äº†Â» Xdebugï¼Œä½ èƒ½é€šè¿‡è°ƒç”¨å‡½æ•° xdebug_debug_zval() æ˜¾ç¤ºâ€refcountâ€å’Œâ€is_refâ€çš„å€¼ã€‚ \u003c?php xdebug_debug_zval ( 'a' ); ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š a: (refcount=1, is_ref=0)='new string' æŠŠä¸€ä¸ªå˜é‡èµ‹å€¼ç»™å¦ä¸€å˜é‡å°†å¢åŠ å¼•ç”¨æ¬¡æ•°(refcount) \u003c?php $a = \"new string\" ; $b = $a ; xdebug_debug_zval ( 'a' ); ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š a: (refcount=2, is_ref=0)='new string' è¿™æ—¶ï¼Œå¼•ç”¨æ¬¡æ•°æ˜¯2ï¼Œå› ä¸ºåŒä¸€ä¸ªå˜é‡å®¹å™¨è¢«å˜é‡ a å’Œå˜é‡ b å…³è”ã€‚ å½“æ²¡å¿…è¦æ—¶ï¼Œphpä¸ä¼šå»å¤åˆ¶å·²ç”Ÿæˆçš„å˜é‡å®¹å™¨ã€‚ å˜é‡å®¹å™¨åœ¨â€refcountâ€œå˜æˆ0æ—¶å°±è¢«é”€æ¯ã€‚ å½“ä»»ä½•å…³è”åˆ°æŸä¸ªå˜é‡å®¹å™¨çš„å˜é‡ç¦»å¼€å®ƒçš„ä½œç”¨åŸŸ(æ¯”å¦‚ï¼šå‡½æ•°æ‰§è¡Œç»“æŸ)ï¼Œæˆ–è€…å¯¹å˜é‡è°ƒç”¨äº†å‡½æ•° unset() æ—¶ï¼Œâ€refcountâ€œå°±ä¼šå‡1ï¼Œä¸‹é¢çš„ä¾‹å­å°±èƒ½è¯´æ˜: \u003c?php $a = \"new string\" ; $c = $b = $a ; xdebug_debug_zval ( 'a' ); unset( $b , $c ); xdebug_debug_zval ( 'a' ); ä»¥ä¸Šä¾‹ç¨‹ä¼šè¾“å‡ºï¼š a: (refcount=3, is_ref=0)='new string' a: (refcount=1, is_ref=0)='new string' å¦‚æœæˆ‘ä»¬ç°åœ¨æ‰§è¡Œ unset($a);ï¼ŒåŒ…å«ç±»å‹å’Œå€¼çš„è¿™ä¸ªå˜é‡å®¹å™¨å°±ä¼šä»å†…å­˜ä¸­åˆ é™¤ã€‚ ","date":"2020-05-25","objectID":"/php%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/:0:2","tags":null,"title":"PHPå¼•ç”¨è®¡æ•°","uri":"/php%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/"},{"categories":["php"],"content":"å¤åˆç±»å‹ å½“è€ƒè™‘åƒ array å’Œ object è¿™æ ·çš„å¤åˆç±»å‹æ—¶ï¼Œäº‹æƒ…å°±ç¨å¾®æœ‰ç‚¹å¤æ‚. ä¸ æ ‡é‡(scalar) ç±»å‹çš„å€¼ä¸åŒï¼Œ array å’Œ object ç±»å‹çš„å˜é‡æŠŠå®ƒä»¬çš„æˆå‘˜æˆ–å±æ€§å­˜åœ¨è‡ªå·±çš„ç¬¦å·è¡¨ä¸­ã€‚è¿™æ„å‘³ç€ä¸‹é¢çš„ä¾‹å­å°†ç”Ÿæˆä¸‰ä¸ªzvalå˜é‡å®¹å™¨ã€‚ \u003c?php $a = array( 'meaning' =\u003e 'life' , 'number' =\u003e 42 ); xdebug_debug_zval ( 'a' ); ä»¥ä¸Šä¾‹ç¨‹çš„è¾“å‡ºç±»ä¼¼äºï¼š a: (refcount=1, is_ref=0)=array ( 'meaning' =\u003e (refcount=1, is_ref=0)='life', 'number' =\u003e (refcount=1, is_ref=0)=42 ) è¿™ä¸‰ä¸ªzvalå˜é‡å®¹å™¨æ˜¯: a ï¼Œ meaning å’Œ number ã€‚å¢åŠ å’Œå‡å°‘â€refcountâ€çš„è§„åˆ™å’Œä¸Šé¢æåˆ°çš„ä¸€æ ·. ä¸‹é¢, æˆ‘ä»¬åœ¨æ•°ç»„ä¸­å†æ·»åŠ ä¸€ä¸ªå…ƒç´ ,å¹¶ä¸”æŠŠå®ƒçš„å€¼è®¾ä¸ºæ•°ç»„ä¸­å·²å­˜åœ¨å…ƒç´ çš„å€¼: \u003c?php $a = array( 'meaning' =\u003e 'life' , 'number' =\u003e 42 ); $a['life'] = $a['meaning']; xdebug_debug_zval ( 'a' ); ä»¥ä¸Šä¾‹ç¨‹çš„è¾“å‡ºç±»ä¼¼äºï¼š a: (refcount=1, is_ref=0)=array ( 'meaning' =\u003e (refcount=2, is_ref=0)='life', 'number' =\u003e (refcount=1, is_ref=0)=42, 'life' =\u003e (refcount=2, is_ref=0)='life' ) ä»ä»¥ä¸Šçš„xdebugè¾“å‡ºä¿¡æ¯ï¼Œæˆ‘ä»¬çœ‹åˆ°åŸæœ‰çš„æ•°ç»„å…ƒç´ å’Œæ–°æ·»åŠ çš„æ•°ç»„å…ƒç´ å…³è”åˆ°åŒä¸€ä¸ªâ€refcountâ€2çš„zvalå˜é‡å®¹å™¨. å°½ç®¡ Xdebugçš„è¾“å‡ºæ˜¾ç¤ºä¸¤ä¸ªå€¼ä¸º*â€˜lifeâ€™*çš„ zval å˜é‡å®¹å™¨ï¼Œå…¶å®æ˜¯åŒä¸€ä¸ªã€‚ å‡½æ•° **xdebug_debug_zval()** ä¸æ˜¾ç¤ºè¿™ä¸ªä¿¡æ¯ï¼Œä½†æ˜¯ä½ èƒ½é€šè¿‡æ˜¾ç¤ºå†…å­˜æŒ‡é’ˆä¿¡æ¯æ¥çœ‹åˆ°ã€‚ åˆ é™¤æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯ç±»ä¼¼äºä»ä½œç”¨åŸŸä¸­åˆ é™¤ä¸€ä¸ªå˜é‡. åˆ é™¤å,æ•°ç»„ä¸­çš„è¿™ä¸ªå…ƒç´ æ‰€åœ¨çš„å®¹å™¨çš„â€œrefcountâ€å€¼å‡å°‘ï¼ŒåŒæ ·ï¼Œå½“â€œrefcountâ€ä¸º0æ—¶ï¼Œè¿™ä¸ªå˜é‡å®¹å™¨å°±ä»å†…å­˜ä¸­è¢«åˆ é™¤ï¼Œä¸‹é¢åˆä¸€ä¸ªä¾‹å­å¯ä»¥è¯´æ˜ï¼š \u003c?php $a = array( 'meaning' =\u003e 'life', 'number' =\u003e 42 ); ï¼‰ $a['life'] = $a['meaning']; unset( $a['meaning'], $a['number']); xdebug_debug_zval('a'); ä»¥ä¸Šä¾‹ç¨‹çš„è¾“å‡ºç±»ä¼¼äºï¼š a: (refcount=1, is_ref=0)=array ( 'life' =\u003e (refcount=1, is_ref=0)='life' ) ç°åœ¨ï¼Œå½“æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ•°ç»„æœ¬èº«ä½œä¸ºè¿™ä¸ªæ•°ç»„çš„å…ƒç´ æ—¶ï¼Œäº‹æƒ…å°±å˜å¾—æœ‰è¶£ï¼Œä¸‹ä¸ªä¾‹å­å°†è¯´æ˜è¿™ä¸ªã€‚ä¾‹ä¸­æˆ‘ä»¬åŠ å…¥äº†å¼•ç”¨æ“ä½œç¬¦ï¼Œå¦åˆ™phpå°†ç”Ÿæˆä¸€ä¸ªå¤åˆ¶ã€‚ \u003c?php $a = array( 'one' ); $a [] =\u0026 $a ; xdebug_debug_zval ( 'a' ); ä»¥ä¸Šä¾‹ç¨‹çš„è¾“å‡ºç±»ä¼¼äºï¼š a: (refcount=2, is_ref=1)=array ( 0 =\u003e (refcount=1, is_ref=0)='one', 1 =\u003e (refcount=2, is_ref=1)=... ) èƒ½çœ‹åˆ°æ•°ç»„å˜é‡ ( a ) åŒæ—¶ä¹Ÿæ˜¯è¿™ä¸ªæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ( 1 ) æŒ‡å‘çš„å˜é‡å®¹å™¨ä¸­â€œrefcountâ€ä¸º 2ã€‚ä¸Šé¢çš„è¾“å‡ºç»“æœä¸­çš„â€â€¦â€è¯´æ˜å‘ç”Ÿäº†é€’å½’æ“ä½œ, æ˜¾ç„¶åœ¨è¿™ç§æƒ…å†µä¸‹æ„å‘³ç€â€â€¦â€æŒ‡å‘åŸå§‹æ•°ç»„ã€‚è·Ÿåˆšåˆšä¸€æ ·ï¼Œå¯¹ä¸€ä¸ªå˜é‡è°ƒç”¨unsetï¼Œå°†åˆ é™¤è¿™ä¸ªç¬¦å·ï¼Œä¸”å®ƒæŒ‡å‘çš„å˜é‡å®¹å™¨ä¸­çš„å¼•ç”¨æ¬¡æ•°ä¹Ÿå‡1ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ‰§è¡Œå®Œä¸Šé¢çš„ä»£ç åï¼Œå¯¹å˜é‡ $a è°ƒç”¨unset, é‚£ä¹ˆå˜é‡ $a å’Œæ•°ç»„å…ƒç´  â€œ1â€ æ‰€æŒ‡å‘çš„å˜é‡å®¹å™¨çš„å¼•ç”¨æ¬¡æ•°å‡1, ä»â€2â€³å˜æˆâ€1â€³. ä¸‹ä¾‹å¯ä»¥è¯´æ˜: (refcount=1, is_ref=1)=array ( 0 =\u003e (refcount=1, is_ref=0)='one', 1 =\u003e (refcount=1, is_ref=1)=... ) ","date":"2020-05-25","objectID":"/php%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/:0:3","tags":null,"title":"PHPå¼•ç”¨è®¡æ•°","uri":"/php%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0/"},{"categories":["swoole"],"content":" è‡ªçŸ¥ä¹‹æ˜æ˜¯æœ€éš¾å¾—çš„çŸ¥è¯†ã€‚ ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:0","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"TCPä¼ è¾“çš„ç‰¹ç‚¹ TCPæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®® é¢å‘è¿æ¥ é¢å‘è¿æ¥æ„å‘³ç€ä½¿ç”¨tcpçš„åº”ç”¨ç¨‹åºåœ¨ä¼ è¾“æ•°æ®å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹ åŸºäºå­—èŠ‚æµçš„ä¼ è¾“ å‘é€ç«¯æ‰§è¡Œçš„å†™æ“ä½œæ•°å’Œæ¥æ”¶ç«¯æ‰§è¡Œçš„è¯»æ“ä½œæ¬¡æ•°ä¹‹é—´æ²¡æœ‰ä»»ä½•æ•°é‡å…³ç³»ï¼Œå½“å‘é€ç«¯åº”ç”¨ç¨‹åºè¿ç»­æ‰§è¡Œå¤šæ¬¡å†™æ“ä½œçš„æ—¶ï¼ŒTCPæ¨¡å—å…ˆå°†è¿™äº›æ•°æ®æ”¾å…¥TCPå‘é€ç¼“å†²åŒºä¸­ã€‚å½“TCPæ¨¡å—çœŸæ­£å¼€å§‹å‘é€æ•°æ®çš„æ—¶å€™ï¼Œå‘é€ç¼“å†²åŒºä¸­è¿™äº›ç­‰å¾…å‘é€çš„æ•°æ®å¯èƒ½è¢«å°è£…æˆä¸€ä¸ªæˆ–å¤šä¸ªTCPæŠ¥æ–‡æ®µå‘å‡º å¯é  TCPåè®®é‡‡ç”¨å‘é€åº”ç­”æœºåˆ¶ï¼Œå³å‘é€ç«¯å‘é€çš„æ¯ä¸ªTCPæŠ¥æ–‡æ®µéƒ½å¿…é¡»å¾—åˆ°æ¥æ”¶æ–¹çš„åº”ç­”ï¼Œæ‰èƒ½è®¤ä¸ºè¿™ä¸ªTCPæŠ¥æ–‡æ®µä¼ è¾“æˆåŠŸã€‚ TCPåè®®é‡‡ç”¨è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œå‘é€ç«¯åœ¨å‘é€å‡ºä¸€ä¸ªTCPæŠ¥æ–‡æ®µä¹‹åå¯åŠ¨å®šæ—¶å™¨ï¼Œå¦‚æœåœ¨å®šæ—¶æ—¶é—´å†…æœªæ”¶åˆ°åº”ç­”ï¼Œå®ƒå°†é‡æ–°å‘é€è¯¥æŠ¥æ–‡æ®µã€‚ ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:1","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"ä»€ä¹ˆæ˜¯TCPç²˜åŒ…é—®é¢˜ TCPç²˜åŒ…æ˜¯ä¸€ä¸ªé”™è¯¯çš„è¯´æ³•ï¼ŒTCPæ˜¯æµå¼ä¼ è¾“ï¼Œæ²¡æœ‰åŒ…çš„æ¦‚å¿µï¼Œæ›´æ²¡æœ‰ç²˜åŒ…ä¸€è¯´ã€‚ äººä»¬å¸¸è¯´çš„ç²˜åŒ…é—®é¢˜ï¼Œæ˜¯æŒ‡å‘é€æ–¹åº”è¯¥ä»¥ä»€ä¹ˆæ ¼å¼å‘é€æ•°æ®ï¼Œæ¥æ”¶æ–¹èƒ½æ­£ç¡®è§£æå‡ºæ•°æ®ï¼Œè¿™ä¸ªå«åº”ç”¨å±‚åè®®ï¼Œä½ è‡ªå·±å®šï¼Œè·ŸTCPå®Œå…¨æ— å…³ã€‚å¦‚æœæ˜¯å‘æ–‡ä»¶ï¼Œæœ€ç®€å•çš„ä½ å¯ä»¥ç”¨httpåè®®å°è£…ï¼Œå¦‚æœä½ å‘çš„httpåè®®æ•°æ®æ˜¯100%æ­£ç¡®çš„ï¼Œæ— è®ºå“ªä¸ªæ¥æ”¶æ–¹ï¼ˆnginx/tomcat/iisï¼‰ä¿è¯èƒ½ä¸€å­—èŠ‚ä¸å·®åœ°æ”¶ä¸‹ï¼Œå› ä¸ºhttpåè®®æœ¬èº«å°±å¸¦headerå’Œbodyï¼Œheaderé‡Œæœ‰Content-Length: 12345æŒ‡å®šäº†bodyçš„å¤§å°ï¼Œbodyæ‰æ˜¯æ–‡ä»¶æœ¬èº«ã€‚ ä½ ä¸ç”¨httpåè®®ï¼Œç›´æ¥å‘æ–‡ä»¶æ•°æ®ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ¥æ”¶æ–¹æ€ä¹ˆçŸ¥é“åº”è¯¥æ”¶å¤šå°‘å­—èŠ‚åæ–‡ä»¶ç»“æŸï¼Ÿè¿™ä¸ªæ‰æ˜¯çœŸæ­£ç²˜åŒ…é—®é¢˜çš„ç”±æ¥ã€‚ æ‰€æœ‰TCPç²˜åŒ…é—®é¢˜å°±è½¬åŒ–æˆäº†å¦‚ä½•ç•Œå®šTCPæµå¼ä¼ è¾“è¾¹ç•Œçš„é—®é¢˜ã€‚ ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:2","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"TCPç²˜åŒ…çš„åŸå›  ç¼“å†²åŒº é€šå¸¸æˆ‘ä»¬ç›´è§‰æ€§çš„è®¤ä¸ºï¼Œå®¢æˆ·ç«¯ç›´æ¥å‘ç½‘ç»œä¸­ä¼ è¾“æ•°æ®ï¼Œå¯¹ç«¯ä»ç½‘ç»œä¸­è¯»å–æ•°æ®ï¼Œä½†æ˜¯è¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚ socketæœ‰ç¼“å†²åŒºbufferçš„æ¦‚å¿µï¼Œæ¯ä¸ªTCP socketåœ¨å†…æ ¸ä¸­éƒ½æœ‰ä¸€ä¸ªå‘é€ç¼“å†²åŒºå’Œä¸€ä¸ªæ¥æ”¶ç¼“å†²åŒºã€‚å®¢æˆ·ç«¯sendæ“ä½œä»…ä»…æ˜¯æŠŠæ•°æ®æ‹·è´åˆ°bufferä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´sendå®Œæˆäº†ï¼Œæ•°æ®å¹¶ä¸ä»£è¡¨å·²ç»å‘é€åˆ°æœåŠ¡ç«¯äº†ï¼Œä¹‹åæ‰ç”±TCPåè®®ä»bufferä¸­å‘é€åˆ°æœåŠ¡ç«¯ã€‚æ­¤æ—¶æœåŠ¡ç«¯çš„æ¥æ”¶ç¼“å†²åŒºè¢«TCPç¼“å­˜ç½‘ç»œä¸Šæ¥çš„æ•°æ®ï¼Œè€Œåserveræ‰ä»bufferä¸­è¯»å–æ•°æ®ã€‚ å½“è¿ç»­å‘é€æ•°æ®æ—¶ï¼Œç”±äºtcpåè®®çš„nagleç®—æ³•ï¼Œä¼šå°†è¾ƒå°çš„å†…å®¹æ‹¼æ¥æˆå¤§çš„å†…å®¹ï¼Œä¸€æ¬¡æ€§å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œå› æ­¤é€ æˆç²˜åŒ… å½“å‘é€å†…å®¹è¾ƒå¤§æ—¶ï¼Œç”±äºæœåŠ¡å™¨ç«¯çš„recvï¼ˆbuffer_sizeï¼‰æ–¹æ³•ä¸­çš„buffer_sizeè¾ƒå°ï¼Œä¸èƒ½ä¸€æ¬¡æ€§å®Œå…¨æ¥æ”¶å…¨éƒ¨å†…å®¹ï¼Œå› æ­¤åœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œæ¥æ”¶çš„å†…å®¹ä¾ç„¶æ˜¯ä¸Šä¸€æ¬¡æ²¡æœ‰å®Œå…¨æ¥æ”¶å®Œçš„å†…å®¹ï¼Œå› æ­¤é€ æˆç²˜åŒ…ç°è±¡ã€‚ æ¥æ”¶æ•°æ®ç«¯çš„åº”ç”¨å±‚æ²¡æœ‰åŠæ—¶è¯»å–æ¥æ”¶ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œå°†å‘ç”Ÿç²˜åŒ…ã€‚ ç²˜åŒ…ã€æ‹†åŒ…è¡¨ç°å½¢å¼ ç¬¬ä¸€ç§æƒ…å†µï¼Œæ¥æ”¶ç«¯æ­£å¸¸æ”¶åˆ°ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œå³æ²¡æœ‰å‘ç”Ÿæ‹†åŒ…å’Œç²˜åŒ…çš„ç°è±¡ã€‚ ç¬¬äºŒç§æƒ…å†µï¼Œæ¥æ”¶ç«¯åªæ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ï¼Œç”±äºTCPæ˜¯ä¸ä¼šå‡ºç°ä¸¢åŒ…çš„ï¼Œæ‰€ä»¥è¿™ä¸€ä¸ªæ•°æ®åŒ…ä¸­åŒ…å«äº†å‘é€ç«¯å‘é€çš„ä¸¤ä¸ªæ•°æ®åŒ…çš„ä¿¡æ¯ï¼Œè¿™ç§ç°è±¡å³ä¸ºç²˜åŒ…ã€‚è¿™ç§æƒ…å†µç”±äºæ¥æ”¶ç«¯ä¸çŸ¥é“è¿™ä¸¤ä¸ªæ•°æ®åŒ…çš„ç•Œé™ï¼Œæ‰€ä»¥å¯¹äºæ¥æ”¶ç«¯æ¥è¯´å¾ˆéš¾å¤„ç†ã€‚ ç¬¬ä¸‰ç§æƒ…å†µï¼Œè¿™ç§æƒ…å†µæœ‰ä¸¤ç§è¡¨ç°å½¢å¼ã€‚æ¥æ”¶ç«¯æ”¶åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ•°æ®åŒ…è¦ä¹ˆæ˜¯ä¸å®Œæ•´çš„ï¼Œè¦ä¹ˆå°±æ˜¯å¤šå‡ºæ¥ä¸€å—ï¼Œè¿™ç§æƒ…å†µå³å‘ç”Ÿäº†æ‹†åŒ…å’Œç²˜åŒ…ã€‚è¿™ä¸¤ç§æƒ…å†µå¦‚æœä¸åŠ ç‰¹æ®Šå¤„ç†ï¼Œå¯¹äºæ¥æ”¶ç«¯åŒæ ·æ˜¯ä¸å¥½å¤„ç†çš„ã€‚ ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:3","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"TCPç²˜åŒ…çš„è§£å†³æ–¹æ³• EOF ç»“æŸç¬¦åè®® å›ºå®šåŒ…å¤´ + åŒ…ä½“åè®® ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:4","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"ç²˜åŒ…å¤ç° åˆ›å»ºä¸€ä¸ªserverï¼Œserverç«¯ä»£ç å¦‚ä¸‹ \u003c?php class TcpBufferServer { private $_serv; /** * init */ public function __construct() { $this-\u003e_serv = new Swoole\\Server(\"127.0.0.1\", 9501); $this-\u003e_serv-\u003eset([ 'worker_num' =\u003e 1, ]); $this-\u003e_serv-\u003eon('Receive', [$this, 'onReceive']); } public function onReceive($serv, $fd, $fromId, $data) { echo \"Server received data: {$data}\" . PHP_EOL; } /** * start server */ public function start() { $this-\u003e_serv-\u003estart(); } } $reload = new TcpBufferServer; $reload-\u003estart(); serverçš„ä»£ç å¾ˆç®€å•ï¼Œä»…ä»…æ˜¯åœ¨æ”¶åˆ°å®¢æˆ·ç«¯ä»£ç åï¼Œæ ‡å‡†è¾“å‡ºä¸€å¥è¯è€Œå·²ï¼Œclientçš„ä»£ç éœ€è¦æ³¨æ„äº†ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªforå¾ªç¯ï¼Œè¿ç»­å‘server sendä¸‰æ¡ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ \u003c?php $client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_SYNC); $client-\u003econnect('127.0.0.1', 9501) || exit(\"connect failed. Error: {$client-\u003eerrCode}\\n\"); // å‘æœåŠ¡ç«¯å‘é€æ•°æ® for ($i = 0; $i \u003c 3; $i++) { $client-\u003esend(\"Just a test.\\n\"); } $client-\u003eclose(); åœ¨æœªè¿è¡Œæµ‹è¯•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœŸæœ›serveræ‰€åœ¨ç»ˆç«¯è¾“å‡ºçš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·çš„ \u003c?php Server received data: Just a test. Server received data: Just a test. Server received data: Just a test. æ³¨æ„å“¦ï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯serverè¢«å›è°ƒäº†3æ¬¡ï¼Œæ‰æœ‰ä¸Šè¿°æœŸæœ›çš„ç»“æœå€¼ å®é™…è¿è¡Œçš„ç»“æœå‘¢ï¼Œæ˜¯å¦ä¸æˆ‘ä»¬æ‰€æœŸæœ›çš„ä¸€è‡´ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹ ä¸Šå›¾å·¦è¾¹æ˜¯serverè¾“å‡ºçš„ä¿¡æ¯ã€‚ æˆ‘ä»¬çœ‹åˆ°ï¼Œå·¦ä¾§æ˜¾ç¤ºçš„ç»“æœæ˜¯serverä¸€æ¬¡æ€§è¾“å‡ºçš„ç»“æœï¼ŒæŒ‰ç†è®ºæ¥è¯´ï¼Œclientå‘èµ·äº†3æ¬¡è¯·æ±‚ï¼Œserveråº”è¯¥è·Ÿæˆ‘ä»¬æœŸæœ›çš„ç»“æœä¸€è‡´ï¼Œä¼šæ‰§è¡Œ3æ¬¡å‘€ï¼Œä½†æ˜¯äº‹å®å¹¶ä¸æ˜¯ï¼Œè¿™å°±äº§ç”Ÿäº†ç²˜åŒ…ï¼Œçœ‹ä¸‹æŠ“åŒ…çš„ç»“æœã€‚ ç”±æŠ“åŒ…çš„å›¾å¯è§ï¼Œä¸‰æ¬¡è¯·æ±‚çš„å†…å®¹åˆ°äº†ç¼“å†²åŒºåï¼Œä½œä¸ºä¸¤æ¬¡å‘é€ï¼Œæœ‰ä¸¤ä¸ªæ•°æ®å‘ç”Ÿäº†ç²˜åŒ…ï¼Œåˆ°äº†æœåŠ¡ç«¯ç¼“å†²åŒºåï¼Œæ˜¯ä¸‰ä¸ªä¸€èµ·å–å‡ºäº§ç”Ÿäº†ç²˜åŒ…ã€‚ ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:5","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"EOFç»“æŸåè®® EOFï¼Œend of fileï¼Œæ„æ€æ˜¯æˆ‘ä»¬åœ¨æ¯ä¸€ä¸ªæ•°æ®åŒ…çš„ç»“å°¾åŠ ä¸€ä¸ªeofæ ‡è®°ï¼Œè¡¨ç¤ºè¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ï¼Œä½†æ˜¯å¦‚æœä½ çš„æ•°æ®æœ¬èº«å«æœ‰EOFæ ‡è®°ï¼Œé‚£å°±ä¼šé€ æˆæ”¶åˆ°çš„æ•°æ®åŒ…ä¸å®Œæ•´ï¼Œæ‰€ä»¥å¼€å¯EOFæ”¯æŒåï¼Œåº”é¿å…æ•°æ®ä¸­å«æœ‰EOFæ ‡è®°ã€‚ åœ¨swoole_serverä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®open_eof_checkä¸ºtrueï¼Œæ‰“å¼€EOFæ£€æµ‹ï¼Œé…ç½®package_eofæ¥æŒ‡å®šEOFæ ‡è®°ã€‚ swoole_serveræ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…æ—¶ï¼Œä¼šæ£€æµ‹æ•°æ®åŒ…çš„ç»“å°¾æ˜¯å¦æ˜¯æˆ‘ä»¬è®¾ç½®çš„EOFæ ‡è®°ï¼Œå¦‚æœä¸æ˜¯å°±ä¼šä¸€ç›´æ‹¼æ¥æ•°æ®åŒ…ï¼Œç›´åˆ°è¶…å‡ºbufferæˆ–è€…è¶…æ—¶æ‰ä¼šç»ˆæ­¢ï¼Œä¸€æ—¦è®¤å®šæ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ï¼Œå°±ä¼šæŠ•é€’ç»™Workerè¿›ç¨‹ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ‰å¯ä»¥åœ¨å›è°ƒå†…å¤„ç†æ•°æ®ã€‚ è¿™æ ·serverå°±èƒ½ä¿è¯æ¥æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…äº†ï¼Ÿä¸èƒ½ä¿è¯ï¼Œè¿™æ ·åªèƒ½ä¿è¯serverèƒ½æ”¶åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚ ä¸ºå•¥æ˜¯å¤šä¸ªå‘¢ï¼Ÿ æˆ‘ä»¬è¯´äº†å¼€å¯EOFæ£€æµ‹ï¼Œå³open_eof_checkè®¾ç½®ä¸ºtrueï¼Œserveråªä¼šæ£€æµ‹æ•°æ®åŒ…çš„æœ«å°¾æ˜¯å¦æœ‰EOFæ ‡è®°ï¼Œå¦‚æœå‘æˆ‘ä»¬å¼€ç¯‡çš„æ¡ˆä¾‹è¿å‘3ä¸ªEOFçš„æ•°æ®ï¼Œserverå¯èƒ½è¿˜æ˜¯ä¼šä¸€æ¬¡æ€§æ”¶åˆ°ï¼Œè¿™æ ·æˆ‘ä»¬åªèƒ½åœ¨å›è°ƒå†…å¯¹æ•°æ®åŒ…è¿›è¡Œæ‹†åˆ†å¤„ç†ã€‚ æˆ‘ä»¬æ‹¿å¼€ç¯‡çš„æ¡ˆä¾‹ä¸ºä¾‹ serverå¼€å¯eofæ£€æµ‹å¹¶æŒ‡å®šeofæ ‡è®°æ˜¯\\r\\nï¼Œä»£ç å¦‚ä¸‹ \u003c?php class TcpBufferServer { private $_serv; /** * init */ public function __construct() { $this-\u003e_serv = new Swoole\\Server(\"127.0.0.1\", 9501); /* $this-\u003e_serv-\u003eset([ 'worker_num' =\u003e 1, ]);*/ $this-\u003e_serv-\u003eset([ 'worker_num' =\u003e 1, 'open_eof_check' =\u003e true, //æ‰“å¼€EOFæ£€æµ‹ 'package_eof' =\u003e \"\\r\\n\", //è®¾ç½®EOF ]); $this-\u003e_serv-\u003eon('Receive', [$this, 'onReceive']); } public function onReceive($serv, $fd, $fromId, $data) { echo \"Server received data: {$data}\" . PHP_EOL; } /** * start server */ public function start() { $this-\u003e_serv-\u003estart(); } } $reload = new TcpBufferServer; $reload-\u003estart(); å®¢æˆ·ç«¯è®¾ç½®å‘é€çš„æ•°æ®æœ«å°¾æ˜¯\\r\\nç¬¦å·ï¼Œä»£ç å¦‚ä¸‹ \u003c?php $client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_SYNC); $client-\u003econnect('127.0.0.1', 9501) || exit(\"connect failed. Error: {$client-\u003eerrCode}\\n\"); // å‘æœåŠ¡ç«¯å‘é€æ•°æ® /*for ($i = 0; $i \u003c 3; $i++) { $client-\u003esend(\"Just a test.\\n\"); }*/ for ($i = 0; $i \u003c 3; $i++) { $client-\u003esend(\"Just a test.\\r\\n\"); } $client-\u003eclose(); æŒ‰ç…§æˆ‘ä»¬åˆšæ‰çš„åˆ†æï¼Œserverçš„æ•ˆæœå¯èƒ½ä¼šä¸€æ¬¡æ€§æ”¶åˆ°å¤šä¸ªå®Œæ•´çš„åŒ…ï¼Œæˆ‘ä»¬è¿è¡Œçœ‹çœ‹ç»“æœ æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼ŒæŠ“åŒ…çš„ç»“æœä¸ä¸Šé¢æ˜¯ä¸€æ ·çš„ã€‚ åŸæ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨onReceiveå›è°ƒå†…å¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œæ‹†åˆ†å¤„ç† \u003c?php public function onReceive($serv, $fd, $fromId, $data) { // echo \"Server received data: {$data}\" . PHP_EOL; $datas = explode(\"\\r\\n\", $data); foreach ($datas as $data) { if(!$data) continue; echo \"Server received data: {$data}\" . PHP_EOL; } } æ­¤æ—¶æˆ‘ä»¬å†çœ‹ä¸‹è¿è¡Œç»“æœ è‡ªè¡Œåˆ†åŒ…çš„æ•ˆæœä¾¿å®ç°äº†ï¼Œè€ƒè™‘åˆ°è‡ªè¡Œåˆ†åŒ…ç¨å¾®éº»çƒ¦ï¼Œswooleæä¾›äº†open_eof_splité…ç½®å‚æ•°ï¼Œå¯ç”¨è¯¥å‚æ•°åï¼Œserverä¼šä»å·¦åˆ°å³å¯¹æ•°æ®è¿›è¡Œé€å­—èŠ‚å¯¹æ¯”ï¼ŒæŸ¥æ‰¾æ•°æ®ä¸­çš„EOFæ ‡è®°è¿›è¡Œåˆ†åŒ…ï¼Œæ•ˆæœè·Ÿæˆ‘ä»¬åˆšåˆšè‡ªè¡Œæ‹†åŒ…æ˜¯ä¸€æ ·çš„ï¼Œæ€§èƒ½è¾ƒå·®ã€‚ åœ¨æ¡ˆä¾‹çš„åŸºç¡€ä¸Šæˆ‘ä»¬çœ‹çœ‹open_eof_splité…ç½® \u003c?php $this-\u003e_serv-\u003eset([ 'worker_num' =\u003e 1, 'open_eof_check' =\u003e true, //æ‰“å¼€EOFæ£€æµ‹ 'package_eof' =\u003e \"\\r\\n\", //è®¾ç½®EOF 'open_eof_split' =\u003e true, ]); onReceiveçš„å›è°ƒï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªè¡Œæ‹†åŒ… \u003c?php public function onReceive($serv, $fd, $fromId, $data) { echo \"Server received data: {$data}\" . PHP_EOL; } clientçš„æµ‹è¯•ä»£ç ä½¿ç”¨\\r\\nï¼ˆåŒserverç«¯package_eofæ ‡è®°ä¸€è‡´ï¼‰ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¿è¡Œæ•ˆæœ EOFæ ‡è®°è§£å†³ç²˜åŒ…å°±è¯´è¿™ä¹ˆå¤šï¼Œä¸‹é¢æˆ‘ä»¬å†çœ‹çœ‹å¦ä¸€ç§è§£å†³æ–¹æ¡ˆ ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:6","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["swoole"],"content":"å›ºå®šåŒ…å¤´+åŒ…ä½“åè®® å›ºå®šåŒ…å¤´æ˜¯ä¸€ç§éå¸¸é€šç”¨çš„åè®®ï¼Œå®ƒçš„å«ä¹‰å°±æ˜¯åœ¨ä½ è¦å‘é€çš„æ•°æ®åŒ…çš„å‰é¢ï¼Œæ·»åŠ ä¸€æ®µä¿¡æ¯ï¼Œè¿™æ®µä¿¡æ¯äº†åŒ…å«äº†ä½ è¦å‘é€çš„æ•°æ®åŒ…çš„é•¿åº¦ï¼Œé•¿åº¦ä¸€èˆ¬æ˜¯2ä¸ªæˆ–è€…4ä¸ªå­—èŠ‚çš„æ•´æ•°ã€‚ åœ¨è¿™ç§åè®®ä¸‹ï¼Œæˆ‘ä»¬çš„æ•°æ®åŒ…çš„ç»„æˆå°±æ˜¯åŒ…å¤´+åŒ…ä½“ã€‚å…¶ä¸­åŒ…å¤´å°±æ˜¯åŒ…ä½“é•¿åº¦çš„äºŒè¿›åˆ¶å½¢å¼ã€‚æ¯”å¦‚æˆ‘ä»¬æœ¬æ¥æƒ³å‘æœåŠ¡ç«¯å‘é€ä¸€æ®µæ•°æ® â€œJust a test.â€ å…±12ä¸ªå­—ç¬¦ï¼Œç°åœ¨æˆ‘ä»¬è¦å‘é€çš„æ•°æ®å°±åº”è¯¥æ˜¯è¿™æ ·çš„ \u003c?php pack('N', strlen(\"Just a test.\")) . \"Just a test.\" å…¶ä¸­phpçš„packå‡½æ•°æ˜¯æŠŠæ•°æ®æ‰“åŒ…æˆäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚ ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½ä¿è¯Workerè¿›ç¨‹æ”¶åˆ°çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…å‘¢ï¼Ÿæˆ‘æ¥è§£é‡Šä¸€ä¸‹ï¼š å½“serveræ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆå¯èƒ½æ˜¯å¤šä¸ªå®Œæ•´çš„æ•°æ®åŒ…ï¼‰ä¹‹åï¼Œä¼šå…ˆè§£å‡ºåŒ…å¤´æŒ‡å®šçš„æ•°æ®é•¿åº¦ï¼Œç„¶åæŒ‰ç…§è¿™ä¸ªé•¿åº¦å–å‡ºåé¢çš„æ•°æ®ï¼Œå¦‚æœä¸€æ¬¡æ€§æ”¶åˆ°å¤šä¸ªæ•°æ®åŒ…ï¼Œä¾æ¬¡å¾ªç¯ï¼Œå¦‚æ­¤å°±èƒ½ä¿è¯Workerè¿›ç¨‹å¯ä»¥ä¸€æ¬¡æ€§æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ã€‚ æˆ‘ä»¬ä»¥æ¡ˆä¾‹æ¥åˆ†æ serverä»£ç  \u003c?php class ServerPack { private $_serv; /** * init */ public function __construct() { $this-\u003e_serv = new Swoole\\Server(\"127.0.0.1\", 9501); $this-\u003e_serv-\u003eset([ 'worker_num' =\u003e 1, 'open_length_check' =\u003e true, // å¼€å¯åè®®è§£æ 'package_length_type' =\u003e 'N', // é•¿åº¦å­—æ®µçš„ç±»å‹ 'package_length_offset' =\u003e 0, //ç¬¬å‡ ä¸ªå­—èŠ‚æ˜¯åŒ…é•¿åº¦çš„å€¼ 'package_body_offset' =\u003e 4, //ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹è®¡ç®—é•¿åº¦ 'package_max_length' =\u003e 81920, //åè®®æœ€å¤§é•¿åº¦ ]); $this-\u003e_serv-\u003eon('Receive', [$this, 'onReceive']); } public function onReceive($serv, $fd, $fromId, $data) { $info = unpack('N', $data); $len = $info[1]; $body = substr($data, - $len); echo \"server received data: {$body}\\n\"; } /** * start server */ public function start() { $this-\u003e_serv-\u003estart(); } } $reload = new ServerPack; $reload-\u003estart(); å®¢æˆ·ç«¯çš„ä»£ç  \u003c?php $client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_SYNC); $client-\u003econnect('127.0.0.1', 9501) || exit(\"connect failed. Error: {$client-\u003eerrCode}\\n\"); // å‘æœåŠ¡ç«¯å‘é€æ•°æ® for ($i = 0; $i \u003c 3; $i++) { $data = \"Just a test.\"; $data = pack('N', strlen($data)) . $data; $client-\u003esend($data); } $client-\u003eclose(); è¿è¡Œçš„ç»“æœ ç»“æœæ²¡é”™ï¼Œæ˜¯æˆ‘ä»¬æœŸæœ›çš„ç»“æœã€‚ æˆ‘ä»¬æ¥åˆ†æä¸‹è¿™æ˜¯ä¸ºä»€ä¹ˆ 1ã€é¦–å…ˆï¼Œåœ¨serverç«¯æˆ‘ä»¬é…ç½®äº†open_length_checkï¼Œè¯¥å‚æ•°è¡¨æ˜æˆ‘ä»¬è¦å¼€å¯å›ºå®šåŒ…å¤´åè®®è§£æ 2ã€package_length_typeé…ç½®ï¼Œè¡¨æ˜åŒ…å¤´é•¿åº¦çš„ç±»å‹ï¼Œè¿™ä¸ªç±»å‹è·Ÿå®¢æˆ·ç«¯ä½¿ç”¨packæ‰“åŒ…åŒ…å¤´çš„ç±»å‹ä¸€è‡´ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºNæˆ–è€…nï¼ŒNè¡¨ç¤º4ä¸ªå­—èŠ‚ï¼Œnè¡¨ç¤º2ä¸ªå­—èŠ‚ 3ã€æˆ‘ä»¬çœ‹ä¸‹å®¢æˆ·ç«¯çš„ä»£ç  pack(â€˜Nâ€™, strlen($data)) . ğ‘‘ğ‘ğ‘¡ğ‘ï¼Œè¿™å¥è¯å°±æ˜¯åŒ…å¤´+åŒ…ä½“çš„æ„æ€ï¼ŒåŒ…å¤´æ˜¯ğ‘ğ‘ğ‘ğ‘˜å‡½æ•°æ‰“åŒ…çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå†…å®¹ä¾¿æ˜¯çœŸå®æ•°æ®çš„é•¿åº¦ğ‘ ğ‘¡ğ‘Ÿğ‘™ğ‘’ğ‘›(dataï¼Œè¿™å¥è¯å°±æ˜¯åŒ…å¤´+åŒ…ä½“çš„æ„æ€ï¼ŒåŒ…å¤´æ˜¯packå‡½æ•°æ‰“åŒ…çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå†…å®¹ä¾¿æ˜¯çœŸå®æ•°æ®çš„é•¿åº¦strlen(data)ã€‚ åœ¨å†…å­˜ä¸­ï¼Œæ•´æ•°ä¸€èˆ¬å ç”¨4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨è¿™æ®µæ•°æ®ä¸­0-4å­—èŠ‚è¡¨ç¤ºçš„æ˜¯åŒ…å¤´ï¼Œå‰©ä½™çš„å°±æ˜¯çœŸå®çš„æ•°æ®ã€‚ä½†æ˜¯serverä¸çŸ¥é“å‘€ï¼Œæ€ä¹ˆå‘Šè¯‰serverè¿™ä¸€äº‹å®å‘¢ï¼Ÿ çœ‹é…ç½®package_length_offsetå’Œpackage_body_offsetï¼Œå‰è€…å°±æ˜¯å‘Šè¯‰serverï¼Œä»ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹æ˜¯é•¿åº¦ï¼Œåè€…å°±æ˜¯ä»ç¬¬å‡ ä¸ªå­—èŠ‚å¼€å§‹è®¡ç®—é•¿åº¦ã€‚ 4ã€æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨onReceiveå›è°ƒå¯¹æ•°æ®è§£åŒ…ï¼Œç„¶åä»åŒ…å¤´ä¸­å–å‡ºåŒ…ä½“é•¿åº¦ï¼Œå†ä»æ¥æ”¶åˆ°çš„æ•°æ®ä¸­æˆªå–çœŸæ­£çš„åŒ…ä½“ã€‚ \u003c?php $info = unpack('N', $data); $len = $info[1]; $body = substr($data, - $len); echo \"server received data: {$body}\\n\"; ","date":"2020-05-25","objectID":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/:0:7","tags":null,"title":"swooleç²˜åŒ…é—®é¢˜","uri":"/swoole%E7%B2%98%E5%8C%85%E9%97%AE%E9%A2%98/"},{"categories":["tcp"],"content":" äººï¼Œåªè¦æœ‰ä¸€ç§ä¿¡å¿µï¼Œæœ‰æ‰€è¿½æ±‚ï¼Œä»€ä¹ˆè‰°è‹¦éƒ½èƒ½å¿å—ï¼Œä»€ä¹ˆç¯å¢ƒä¹Ÿéƒ½èƒ½é€‚åº”ã€‚â€”â€”ä¸ç² ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:0","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"ä¸‰æ¬¡æ¡æ‰‹æµç¨‹å›¾ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:1","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"å››æ¬¡æŒ¥æ‰‹æµç¨‹å›¾ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:2","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"tcpæŠ¥æ–‡ å…¶ä¸­ï¼ŒSeq(Sequence Number) æ˜¯ 32 ä½çš„åºåˆ—å·ï¼ŒAcknowledgment number ç§°ä¹‹ä¸ºç¡®è®¤åºå·ï¼Œä¹Ÿæ˜¯ 32 ä½çš„ï¼Œä½†æ˜¯ä»–ä¸æ˜¯æ ‡å¿—ä½ ACKï¼Œè¿™ä¸ªè¦åŒºåˆ«å¼€ï¼Œå½“ ACK ç½® 1 æ—¶ Acknowledgment number æ‰æœ‰æ•ˆï¼ŒæŒ‡æ¥æ”¶æ–¹æœŸå¾…çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºåˆ—å·ã€‚ TCP æŠ¥å¤´ä¿¡æ¯ä¸­æœ‰å…­ä¸ªæ§åˆ¶ä½(æ ‡å¿—ä½)ï¼Œåˆ†åˆ«æ˜¯ï¼šSYNã€ACKã€PSHã€FINã€RST å’Œ URGã€‚ SYN: è¡¨ç¤ºå»ºç«‹è¿æ¥ FIN: è¡¨ç¤ºå…³é—­è¿æ¥ ACK: è¡¨ç¤ºå“åº” PSH: è¡¨ç¤ºæœ‰æ•°æ®ä¼ è¾“ RST: è¡¨ç¤ºè¿æ¥é‡ç½® URG: è¡¨ç¤ºç´§æ€¥æ•°æ® Seq åºåˆ—å·æœ‰ä¸¤ä¸ªä½œç”¨ï¼š ç¬¬ä¸€ï¼Œåœ¨ SYN ç½® 1 æ—¶ï¼Œæ­¤ä¸ºå½“å‰è¿æ¥çš„åˆå§‹åºåˆ—å·(Initial Sequence Number, ISN)è¯¥å€¼æ˜¯ä¸ªéšæœºå€¼ï¼Œæ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºå·ä¸ºæ­¤ ISN+1ã€‚ ç¬¬äºŒï¼Œåœ¨ SYN ç½® 0 æ—¶ï¼Œä¸ºå½“å‰è¿æ¥æŠ¥æ–‡æ®µçš„ç´¯è®¡æ•°æ®åŒ…å­—èŠ‚æ•°ã€‚ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:3","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"ç½‘ç»œæ¨¡å‹ è®¡ç®—æœºç½‘ç»œåˆ†å±‚æ¨¡å‹ä¸»è¦æœ‰OSIä¸ƒå±‚æ¨¡å‹ï¼ŒTCP/IPäº”å±‚æ¨¡å‹ï¼Œä¹Ÿæœ‰ä¸€ç§å››å±‚æ¨¡å‹ï¼Œå››å±‚æ¨¡å‹ä¼šæŠŠç½‘å¡å±‚å’Œç‰©ç†å±‚ç»Ÿç§°ä¸ºç½‘ç»œæ¥å£å±‚ã€‚ OSIä¸ƒå±‚æ¨¡å‹å­˜åœ¨äºæ•™ç§‘ä¹¦äº†ï¼ŒTCP/IPäº”å±‚æ¨¡å‹æ˜¯æ—¥å¸¸è¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œæ¶æ„æ¨¡å‹ã€‚åœ¨å­¦ä¹ ç½‘ç»œçŸ¥è¯†æ—¶ä¹Ÿè¦æŠŠæ¡ä½é‡ç‚¹å»å­¦ï¼Œä¸ƒå±‚æ¨¡å‹äº†è§£å³å¯ã€‚ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:4","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"ä»£ç å‡†å¤‡ server.php \u003c?php //åˆ›å»ºServerå¯¹è±¡ï¼Œç›‘å¬ 127.0.0.1:9501ç«¯å£ $serv = new Swoole\\Server(\"127.0.0.1\", 9501); //ç›‘å¬è¿æ¥è¿›å…¥äº‹ä»¶ $serv-\u003eon('Connect', function ($serv, $fd) { echo \"Client: Connect.\\n\"; }); //ç›‘å¬æ•°æ®æ¥æ”¶äº‹ä»¶ $serv-\u003eon('Receive', function ($serv, $fd, $from_id, $data) { $serv-\u003esend($fd, \"Server: \".$data); }); //ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶ $serv-\u003eon('Close', function ($serv, $fd) { echo \"Client: Close.\\n\"; }); //å¯åŠ¨æœåŠ¡å™¨ $serv-\u003estart(); client.php \u003c?php //client.php $client = new swoole_client(SWOOLE_SOCK_TCP, SWOOLE_SOCK_SYNC); $client-\u003econnect('127.0.0.1', 9501) || exit(\"connect failed. Error: {$client-\u003eerrCode}\\n\"); // å‘æœåŠ¡ç«¯å‘é€æ•°æ® $client-\u003esend(\"Just a test.\\r\\n\"); $client-\u003eclose(); ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:5","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"wiresharkå‡†å¤‡ æŠ“åŒ…ç½‘ç»œé€‰æ‹©lookback ç­›é€‰æ¡ä»¶è¾“å…¥ip.addr == 127.0.0.1 and tcp.port in {9501} ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:6","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"Tcpè¯·æ±‚ ç›´æ¥è¯·æ±‚client.php php client.php ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:7","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"æŠ“åŒ… ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:8","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"æ¨¡å‹åˆ†æ ä¸Šé¢æ¨¡å‹ç½‘ç»œé‡Œæœ‰äº”å±‚ï¼Œè¿™é‡Œåªæœ‰å››å±‚ï¼Œæ˜¯å› ä¸ºæˆ‘ç›´æ¥è¯·æ±‚çš„tcpï¼Œæ²¡æœ‰èµ°åº”ç”¨å±‚ï¼Œæ‰€ä»¥åªæœ‰å››å±‚ã€‚ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:9","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"ä¸‰æ¬¡æ¡æ‰‹æŠ“åŒ…åˆ†æ çœ‹åˆ°wiresharkå·²ç»æŠ“åˆ°äº†è¯·æ±‚ ç¬¬ä¸€æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¿æ¥è¯·æ±‚åŒ…ï¼Œæ ‡å¿—ä½SYN=1ï¼Œåºåˆ—å·Seq=0ï¼ˆä¸ºæ–¹ä¾¿ä¸‹é¢çš„è®¡ç®—ç”¨è¿™é‡Œçš„Seqèµ·åä¸ºXï¼‰ï¼Œå¦‚ä¸‹å›¾ ç¬¬äºŒæ¬¡æ¡æ‰‹ æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘è¿‡æ¥æŠ¥æ–‡ï¼Œç”±SYN=1çŸ¥é“å®¢æˆ·ç«¯è¦æ±‚å»ºç«‹è”æœºã€‚å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYNå’ŒACKéƒ½ä¸º1çš„TCPæŠ¥æ–‡ï¼Œè®¾ç½®åˆå§‹åºå·Seq=0ï¼ˆä¸ºæ–¹ä¾¿ä¸‹é¢çš„è®¡ç®—ç”¨è¿™é‡Œçš„Seqèµ·åä¸ºYï¼‰ï¼Œå°†ç¡®è®¤åºå·(Acknowledgement Number)è®¾ç½®ä¸ºå®¢æˆ·çš„åºåˆ—å·åŠ 1ï¼Œå³X+1=0+1=1ï¼Œæ‰€ä»¥è¿™é‡Œçš„åºåˆ—å·ä¸º1, å¦‚ä¸‹å›¾ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„åŒ…åæ£€æŸ¥ç¡®è®¤åºå·(Acknowledgement Number)æ˜¯å¦æ­£ç¡®ï¼Œå³ç¬¬ä¸€æ¬¡å‘é€çš„åºå·åŠ 1ï¼ˆX+1=1ï¼‰ã€‚ä»¥åŠæ ‡å¿—ä½ACKæ˜¯å¦ä¸º1ã€‚è‹¥æ­£ç¡®ï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘é€ç¡®è®¤åŒ…ï¼ŒACKæ ‡å¿—ä½ä¸º1ï¼ŒSYNæ ‡å¿—ä½ä¸º0ã€‚ç¡®è®¤åºå·(Acknowledgement Number)=Y+1=0+1=1ï¼Œå‘é€åºå·ä¸ºX+1=1ã€‚æœåŠ¡ç«¯æ”¶åˆ°åç¡®è®¤åºå·å€¼ä¸ACK=1åˆ™è¿æ¥å»ºç«‹æˆåŠŸï¼Œå¯ä»¥ä¼ é€æ•°æ®äº†ã€‚ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:10","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":["tcp"],"content":"å››æ¬¡æŒ¥æ‰‹æŠ“åŒ…åˆ†æ ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ å®¢æˆ·ç«¯ç»™æœåŠ¡å™¨å‘é€TCPåŒ…ï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®ä¼ é€ã€‚å°†æ ‡å¿—ä½FINå’ŒACKç½®ä¸º1ï¼Œåºå·ä¸ºX=15ï¼Œç¡®è®¤åºå·ä¸ºZ=1ã€‚ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ æœåŠ¡å™¨æ”¶åˆ°FINåï¼Œå‘å›ä¸€ä¸ªACK(æ ‡å¿—ä½ACK=1),ç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1ï¼Œå³X=X+1=16ã€‚åºå·ä¸ºæ”¶åˆ°çš„ç¡®è®¤åºå·=Zã€‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ æœåŠ¡å™¨å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ªFINã€‚æ ‡å¿—ä½FINå’ŒACKç½®ä¸º1ï¼Œåºå·ä¸ºY=1ï¼Œç¡®è®¤åºå·ä¸ºX=16ã€‚ ç¬¬å››æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„FINä¹‹åï¼Œå‘å›ACKç¡®è®¤(æ ‡å¿—ä½ACK=1),ç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1ï¼Œå³Y+1=2ã€‚åºå·ä¸ºæ”¶åˆ°çš„ç¡®è®¤åºå·X=16ã€‚ ","date":"2020-05-24","objectID":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/:0:11","tags":null,"title":"tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","uri":"/tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"},{"categories":null,"content":" Â LoveIt æ˜¯ä¸€ä¸ªç”± Dillon å¼€å‘çš„ç®€æ´ã€ä¼˜é›…ä¸”é«˜æ•ˆçš„ Hugo åšå®¢ä¸»é¢˜ã€‚ å®ƒçš„åŸå‹åŸºäº LeaveIt ä¸»é¢˜ å’Œ KeepIt ä¸»é¢˜ã€‚ Hugo ä¸»é¢˜ LoveItHugo ä¸»é¢˜ LoveIt \" Hugo ä¸»é¢˜ LoveIt ","date":"2019-08-02","objectID":"/about/:0:0","tags":null,"title":"å…³äº LoveIt","uri":"/about/"},{"categories":null,"content":"ç‰¹æ€§ æ€§èƒ½å’Œ SEO Â æ€§èƒ½ä¼˜åŒ–ï¼šåœ¨ Google PageSpeed Insights ä¸­ï¼Œ 99/100 çš„ç§»åŠ¨è®¾å¤‡å¾—åˆ†å’Œ 100/100 çš„æ¡Œé¢è®¾å¤‡å¾—åˆ† Â ä½¿ç”¨åŸºäº JSON-LD æ ¼å¼ çš„ SEO SCHEMA æ–‡ä»¶è¿›è¡Œ SEO ä¼˜åŒ– Â æ”¯æŒ Google Analytics Â æ”¯æŒ Fathom Analytics Â æ”¯æŒæœç´¢å¼•æ“çš„ç½‘ç«™éªŒè¯ (Google, Bind, Yandex and Baidu) Â æ”¯æŒæ‰€æœ‰ç¬¬ä¸‰æ–¹åº“çš„ CDN Â åŸºäº lazysizes è‡ªåŠ¨è½¬æ¢å›¾ç‰‡ä¸ºæ‡’åŠ è½½ å¤–è§‚å’Œå¸ƒå±€ / å“åº”å¼å¸ƒå±€ / æµ…è‰²/æ·±è‰² ä¸»é¢˜æ¨¡å¼ Â å…¨å±€ä¸€è‡´çš„è®¾è®¡è¯­è¨€ Â æ”¯æŒåˆ†é¡µ Â æ˜“ç”¨å’Œè‡ªåŠ¨å±•å¼€çš„æ–‡ç« ç›®å½• Â æ”¯æŒå¤šè¯­è¨€å’Œå›½é™…åŒ– Â ç¾è§‚çš„ CSS åŠ¨ç”» ç¤¾äº¤å’Œè¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Gravatar å¤´åƒ Â æ”¯æŒæœ¬åœ°å¤´åƒ Â æ”¯æŒå¤šè¾¾ 64 ç§ç¤¾äº¤é“¾æ¥ Â æ”¯æŒå¤šè¾¾ 28 ç§ç½‘ç«™åˆ†äº« Â æ”¯æŒ Disqus è¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Gitalk è¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Valine è¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Facebook è¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Telegram comments è¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Commento è¯„è®ºç³»ç»Ÿ Â æ”¯æŒ Utterances è¯„è®ºç³»ç»Ÿ æ‰©å±•åŠŸèƒ½ Â æ”¯æŒåŸºäº Lunr.js æˆ– algolia çš„æœç´¢ Â æ”¯æŒ Twemoji Â æ”¯æŒä»£ç é«˜äº® Â ä¸€é”®å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿ Â æ”¯æŒåŸºäº lightgallery.js çš„å›¾ç‰‡ç”»å»Š Â æ”¯æŒ Font Awesome å›¾æ ‡çš„æ‰©å±• Markdown è¯­æ³• Â æ”¯æŒä¸Šæ ‡æ³¨é‡Šçš„æ‰©å±• Markdown è¯­æ³• Â æ”¯æŒåˆ†æ•°çš„æ‰©å±• Markdown è¯­æ³• Â æ”¯æŒåŸºäº $ \\KaTeX $ çš„æ•°å­¦å…¬å¼ Â æ”¯æŒåŸºäº mermaid çš„å›¾è¡¨ shortcode Â æ”¯æŒåŸºäº ECharts çš„äº¤äº’å¼æ•°æ®å¯è§†åŒ– shortcode Â æ”¯æŒåŸºäº Mapbox GL JS çš„ Mapbox shortcode Â æ”¯æŒåŸºäº APlayer å’Œ MetingJS çš„éŸ³ä¹æ’­æ”¾å™¨ shortcode Â æ”¯æŒ Bilibili è§†é¢‘ shortcode Â æ”¯æŒå¤šç§æ³¨é‡Šçš„ shortcode Â æ”¯æŒè‡ªå®šä¹‰æ ·å¼çš„ shortcode Â æ”¯æŒè‡ªå®šä¹‰è„šæœ¬çš„ shortcode Â æ”¯æŒåŸºäº TypeIt çš„æ‰“å­—åŠ¨ç”» shortcode Â æ”¯æŒåŸºäº Smooth Scroll çš„æ»šåŠ¨åŠ¨ç”» Â æ”¯æŒåŸºäº cookieconsent çš„ Cookie è®¸å¯æ¨ªå¹… â€¦ ","date":"2019-08-02","objectID":"/about/:0:1","tags":null,"title":"å…³äº LoveIt","uri":"/about/"},{"categories":null,"content":"è®¸å¯åè®® LoveIt æ ¹æ® MIT è®¸å¯åè®®æˆæƒã€‚ æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ LICENSE æ–‡ä»¶ã€‚ LoveIt ä¸»é¢˜ä¸­ç”¨åˆ°äº†ä»¥ä¸‹é¡¹ç›®ï¼Œæ„Ÿè°¢å®ƒä»¬çš„ä½œè€…ï¼š normalize.css Font Awesome Simple Icons Animate.css Smooth Scroll autocomplete.js Lunr.js algoliasearch lazysizes object-fit-images Twemoji lightgallery.js clipboard.js Sharer.js TypeIt $ \\KaTeX $ mermaid ECharts Mapbox GL JS APlayer MetingJS Gitalk Valine cookieconsent ","date":"2019-08-02","objectID":"/about/:0:2","tags":null,"title":"å…³äº LoveIt","uri":"/about/"}]